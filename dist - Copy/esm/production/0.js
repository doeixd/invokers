var A=Object.defineProperty;var M=(r,e)=>{for(var t in e)A(r,t,{get:e[t],enumerable:!0})};var T={};M(T,{commands:()=>h,registerAll:()=>I});var h={"media:toggle":r=>{let e=r.getTargets()[0];if(!e||typeof e.play!="function")return;let{invoker:t}=r,n=t.dataset.playText||"Pause",a=t.dataset.pauseText||"Play";e.paused?e.play().then(()=>{t.textContent=n,t.setAttribute("aria-pressed","true")}).catch(o=>console.error("Invokers: Media play failed.",o)):(e.pause(),t.textContent=a,t.setAttribute("aria-pressed","false"))},"media:seek":r=>{let e=r.getTargets()[0],t=parseFloat(r.invoker.dataset.seek||"0");!e||!isFinite(t)||(e.currentTime=Math.max(0,Math.min(e.duration,e.currentTime+t)))},"media:mute":r=>{let e=r.getTargets()[0];e&&(e.muted=!e.muted,r.invoker.setAttribute("aria-pressed",String(e.muted)))},"carousel:nav":r=>{let e=r.getTargets()[0],t=r.invoker.dataset.direction;if(!e||t!=="next"&&t!=="prev")return;let n=Array.from(e.children);if(n.length<2)return;let a=n.findIndex(d=>!d.hasAttribute("hidden")),o=a===-1?0:a,s=t==="next"?(o+1)%n.length:(o-1+n.length)%n.length,i=()=>{n.forEach((d,c)=>{d.toggleAttribute("hidden",c!==s)})};document.startViewTransition?document.startViewTransition(i):i()},"clipboard:copy":async r=>{let e=r.getTargets()[0],{invoker:t}=r;if(!e)return;if(!navigator.clipboard){console.warn("Invokers: Clipboard API not available or not in a secure context.");return}let n=t.textContent||"",a=t.dataset.feedbackText||"Copied!",o=t.dataset.errorText||"Error!",s=e.tagName==="INPUT"||e.tagName==="TEXTAREA"?e.value:e.textContent||"";t.setAttribute("disabled","");try{await navigator.clipboard.writeText(s),t.textContent=a}catch(i){console.error("Invokers: Failed to copy text.",i),t.textContent=o}finally{setTimeout(()=>{t.textContent=n,t.removeAttribute("disabled")},2e3)}},"form:reset":r=>{let e=r.getTargets()[0];e instanceof HTMLFormElement&&e.reset()},"form:submit":r=>{let e=r.getTargets()[0];e instanceof HTMLFormElement&&e.requestSubmit()},"input:step":r=>{let e=r.getTargets()[0];if(!(e instanceof HTMLInputElement)||e.type!=="number")return;let t=parseFloat(r.invoker.dataset.step||"0");isFinite(t)&&(t>0?e.stepUp(t):t<0&&e.stepDown(Math.abs(t)),e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})))},"scroll:to":r=>{let e=r.getTargets()[0];e&&e.scrollIntoView({behavior:"smooth",block:"start"})},"dom:remove":r=>{let e=r.getTargets();if(e.length===0)return;let t=()=>e.forEach(n=>n.remove());document.startViewTransition?document.startViewTransition(t):t()},"dom:replace":r=>{let e=r.getTargets();if(e.length===0)return;let t=g(r.invoker);if(!t)return;let n=()=>{e.forEach((a,o)=>{let s=o===0?t:t.cloneNode(!0);a.replaceWith(s)})};document.startViewTransition?document.startViewTransition(n):n()},"dom:swap":r=>{let e=r.getTargets();if(e.length===0)return;let t=g(r.invoker);if(!t)return;let n=()=>{e.forEach((a,o)=>{let s=o===0?t:t.cloneNode(!0);a.replaceChildren(s)})};document.startViewTransition?document.startViewTransition(n):n()},"dom:append":r=>{let e=r.getTargets();if(e.length===0)return;let t=g(r.invoker);t&&e.forEach((n,a)=>{let o=a===0?t:t.cloneNode(!0);n.append(o)})},"dom:prepend":r=>{let e=r.getTargets();if(e.length===0)return;let t=g(r.invoker);t&&e.forEach((n,a)=>{let o=a===0?t:t.cloneNode(!0);n.prepend(o)})},"fetch:get":async r=>{let{invoker:e,getTargets:t}=r,n=t(),a=e.dataset.url;if(!a){console.warn("Invokers: `fetch:get` requires a `data-url` attribute.",e);return}if(n.length===0){console.warn("Invokers: `fetch:get` requires `aria-controls` or `data-target`.",e);return}f(e,!0),p(e,n,"data-loading-template");try{let o=await fetch(a,{method:"GET",headers:{Accept:"text/html",...b(e)}});if(!o.ok)throw new Error(`HTTP ${o.status} ${o.statusText}`);let s=await o.text(),i=w(s),d=()=>{n.forEach((c,l)=>{let m=l===0?i:i.cloneNode(!0);c.replaceChildren(m)})};await(document.startViewTransition?document.startViewTransition(d).finished:Promise.resolve(d())),E(e,n)}catch(o){console.error("Invokers: `fetch:get` failed.",o),p(e,n,"data-error-template")}finally{f(e,!1)}},"fetch:send":async r=>{let e=r.getTargets()[0];if(!(e instanceof HTMLFormElement)){console.warn("Invokers: `fetch:send` requires `aria-controls` to point to a valid <form>.",r.invoker);return}let t=r.invoker.dataset.responseTarget,n=t?Array.from(document.querySelectorAll(t)):[e],a=e.action,o=(e.method||"POST").toUpperCase();if(!a){console.warn("Invokers: Target form for `fetch:send` must have an `action` attribute.",e);return}f(r.invoker,!0),p(r.invoker,n,"data-loading-template");try{let s=await fetch(a,{method:o,body:new FormData(e),headers:b(r.invoker)});if(!s.ok)throw new Error(`HTTP ${s.status} ${s.statusText}`);let i=await s.text(),d=w(i),c=()=>{n.forEach((l,m)=>{let u=m===0?d:d.cloneNode(!0);l.replaceChildren(u)})};await(document.startViewTransition?document.startViewTransition(c).finished:Promise.resolve(c())),E(r.invoker,n)}catch(s){console.error(`Invokers: \`fetch:send\` (${o}) failed.`,s),p(r.invoker,n,"data-error-template")}finally{f(r.invoker,!1)}},"navigate:to":r=>{let e=r.invoker.dataset.url;if(!e){console.warn("Invokers: `navigate:to` command requires a `data-url` attribute.",r.invoker);return}window.history&&typeof window.history.pushState=="function"?(window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))):window.location.href=e}};function I(r){if(!window.Invoker){console.error("Invokers core library not found. Please ensure it is loaded before the commands module.");return}let e=r||Object.keys(h);for(let t of e)h[t]&&window.Invoker.register(t,h[t])}function g(r){let e=r.dataset.templateId,t=r.dataset.cloneId;if(e){let n=document.getElementById(e);return n instanceof HTMLTemplateElement?n.content.cloneNode(!0):(console.error(`Invokers: Source with ID "${e}" not found or is not a <template>.`,r),null)}if(t){let n=document.getElementById(t);if(!n)return console.error(`Invokers: Clone source with ID "${t}" not found.`,r),null;let a=document.createDocumentFragment();return a.appendChild(n.cloneNode(!0)),a}return console.warn("Invokers: DOM command requires `data-template-id` or `data-clone-id`.",r),null}function f(r,e){r.toggleAttribute("disabled",e),r.setAttribute("aria-busy",String(e))}function p(r,e,t){let n=r.getAttribute(t);if(!n||e.length===0)return;let a=document.getElementById(n);if(!(a instanceof HTMLTemplateElement)){console.warn(`Invokers: Feedback template "#${n}" not found or is not a <template>.`);return}let o=a.content.cloneNode(!0);e.forEach((s,i)=>{let d=i===0?o:o.cloneNode(!0);s.replaceChildren(d)})}function w(r){let t=new DOMParser().parseFromString(r,"text/html"),n=document.createDocumentFragment();return n.append(...Array.from(t.body.childNodes)),n}function E(r,e){let t=r.dataset.thenCommand;if(!t||e.length===0)return;let n=document.createElement("button");n.setAttribute("command",t);for(let i in r.dataset)if(i.startsWith("then")){let d=i.charAt(4).toLowerCase()+i.slice(5);n.dataset[d]=r.dataset[i]}let a=e.map(i=>i.id).filter(Boolean);a.length>0&&n.setAttribute("aria-controls",a.join(" "));let o=e[0],s=new CustomEvent("command",{bubbles:!0,cancelable:!0,detail:{command:t,invokerElement:n}});s.command=t,s.invokerElement=n,o.dispatchEvent(s)}function b(r){let e={};for(let t in r.dataset)if(t.startsWith("header")){let n=t.substring(6).replace(/([A-Z])/g,"-$1").toLowerCase();n&&(e[n]=r.dataset[t])}return e}function k(r){var a;let e=[],t="",n=0;for(;n<r.length;){let o=r[n];o==="\\"?(t+=(a=r[n+1])!=null?a:"",n+=2):o===":"?(e.push(t),t="",n++):(t+=o,n++)}return e.push(t),e}function x(...r){return r.map(e=>e.replace(/\\/g,"\\\\").replace(/:/g,"\\:")).join(":")}var v=class{constructor(){this.commands=new Map;this.sortedCommandKeys=[];typeof window!="undefined"&&typeof document!="undefined"&&(this.registerCoreCommands(),this.listen())}register(e,t){this.commands.has(e)&&console.warn(`Invokers: Command "${e}" is already registered and will be overwritten.`),this.commands.set(e,t),this.sortedCommandKeys=Array.from(this.commands.keys()).sort((n,a)=>a.length-n.length)}handleCommand(e){let t=e.command;for(let n of this.sortedCommandKeys)if(t.startsWith(n)&&(t.length===n.length||t[n.length]===":")){let a=this.commands.get(n);if(a){let o=t.substring(n.length+1),s=o?k(o):[];a(this.createContext(e,s))}return}}createContext(e,t){let n=e.invokerElement,a=o=>{var d;let s=(d=o.getAttribute("aria-controls"))==null?void 0:d.trim(),i=s?"#"+s.split(/\s+/).join(", #"):o.dataset.target;return i?Array.from(document.querySelectorAll(i)):[]};return{invoker:n,targetElement:e.target,params:t,getTargets:()=>a(n),updateAriaState:o=>{let s=o.some(i=>!i.hasAttribute("hidden"));n.setAttribute("aria-expanded",String(s)),n.hasAttribute("aria-pressed")&&n.setAttribute("aria-pressed",String(s))},manageGroupState:()=>{let o=a(n);if(o.length===0||!o[0].parentElement)return;let s=o[0].parentElement,i=new Set(Array.from(s.children).map(c=>c.id).filter(Boolean));Array.from(document.querySelectorAll("[aria-controls]")).filter(c=>{var m,u;return((u=(m=c.getAttribute("aria-controls"))==null?void 0:m.split(/\s+/))!=null?u:[]).some(y=>i.has(y))}).forEach(c=>{c!==n&&(c.setAttribute("aria-expanded","false"),c.hasAttribute("aria-pressed")&&c.setAttribute("aria-pressed","false"))})}}}listen(){document.addEventListener("command",e=>this.handleCommand(e))}registerCoreCommands(){this.register("toggle",e=>{let t=e.getTargets();if(t.length===0)return;let n=()=>{t.forEach(a=>a.toggleAttribute("hidden")),e.updateAriaState(t)};document.startViewTransition?document.startViewTransition(n):n()}),this.register("show",e=>{let t=e.getTargets();if(t.length===0||!t[0].parentElement)return;let n=t[0].parentElement,a=Array.from(n.children),o=()=>{e.manageGroupState(),a.forEach(s=>s.setAttribute("hidden","")),t.forEach(s=>s.removeAttribute("hidden")),e.updateAriaState(t)};document.startViewTransition?document.startViewTransition(o):o()}),this.register("hide",e=>{let t=e.getTargets();t.length!==0&&(t.forEach(n=>n.setAttribute("hidden","")),e.updateAriaState(t))}),this.register("class",e=>{let[t,n]=e.params,a=e.getTargets();if(!t||!n||a.length===0){console.warn('Invokers: `class` command requires an action and a class name (e.g., "class:toggle:my-class").',e.invoker);return}a.forEach(o=>{switch(t){case"add":o.classList.add(n);break;case"remove":o.classList.remove(n);break;case"toggle":o.classList.toggle(n);break;default:console.warn(`Invokers: Unknown action "${t}" for 'class' command.`)}})})}},C=new v;typeof window!="undefined"&&(window.Invoker={register:C.register.bind(C),parseCommandString:k,createCommandString:x});var H=C;export{v as InvokerManager,T as commands,x as createCommandString,H as default,k as parseCommandString};
/**
 * @file invoker.ts
 * @version 0.0.0
 * @summary A type-safe, platform-first library that brings declarative HTML and ARIA attributes to life.
 * @license MIT
 * @author Patrick Glenn
 * @see https://github.com/doeixd/invokers
 */
