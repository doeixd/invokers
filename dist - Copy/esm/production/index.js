function Ue(){let s=typeof window!="undefined"?window:globalThis;return typeof HTMLButtonElement!="undefined"&&"command"in HTMLButtonElement.prototype&&"source"in((s.CommandEvent||{}).prototype||{})}function ve(s,e,t=!0){Object.defineProperty(s,e,{...Object.getOwnPropertyDescriptor(s,e),enumerable:t})}function $(s){return s&&typeof s.getRootNode=="function"?s.getRootNode():s&&s.parentNode?$(s.parentNode):s}var re=new WeakMap,ne=new WeakMap,P=class extends Event{constructor(e,t={}){super(e,t);let{source:r,command:n}=t;if(r!=null&&!(r instanceof Element))throw new TypeError("source must be an element");re.set(this,r||null),ne.set(this,n!==void 0?String(n):"")}get[Symbol.toStringTag](){return"CommandEvent"}get source(){if(!re.has(this))throw new TypeError("illegal invocation");let e=re.get(this);if(!(e instanceof Element))return null;let t=$(e);return t!==$(this.target||document)?t instanceof ShadowRoot?t.host:null:e}get command(){if(!ne.has(this))throw new TypeError("illegal invocation");return ne.get(this)||""}get action(){throw new Error("CommandEvent#action was renamed to CommandEvent#command")}get invoker(){throw new Error("CommandEvent#invoker was renamed to CommandEvent#source")}};ve(P.prototype,"source");ve(P.prototype,"command");var oe=class extends Event{constructor(e,t={}){throw super(e,t),new Error("InvokeEvent has been deprecated, it has been renamed to `CommandEvent`")}},q=new WeakMap;function ae(s){Object.defineProperties(s.prototype,{commandForElement:{enumerable:!0,configurable:!0,set(e){if(this.hasAttribute("invokeaction"))throw new TypeError("Element has deprecated `invokeaction` attribute, replace with `command`");if(this.hasAttribute("invoketarget"))throw new TypeError("Element has deprecated `invoketarget` attribute, replace with `commandfor`");if(e===null)this.removeAttribute("commandfor"),q.delete(this);else if(e instanceof Element){this.setAttribute("commandfor",e.id||"");let t=$(e);$(this)===t||t===this.ownerDocument?q.set(this,e):q.delete(this)}else throw new TypeError("commandForElement must be an element or null")},get(){if(this.localName!=="button"&&this.localName!=="input"&&this.localName!=="textarea")return null;if(this.hasAttribute("invokeaction")||this.hasAttribute("invoketarget"))return console.warn("Element has deprecated `invoketarget` or `invokeaction` attribute, use `commandfor` and `command` instead"),null;if(this.disabled)return null;if(this.form&&this.getAttribute("type")!=="button")return console.warn("Element with `commandfor` is a form participant. It should explicitly set `type=button` in order for `commandfor` to work"),null;let e=q.get(this);if(e)return e.isConnected?e:(q.delete(this),null);let t=$(this),r=this.getAttribute("commandfor");return(t instanceof Document||t instanceof ShadowRoot)&&r&&t.getElementById(r)||null}},command:{enumerable:!0,configurable:!0,get(){let e=this.getAttribute("command")||"";if(e.startsWith("--"))return e;let t=e.toLowerCase();switch(t){case"show-modal":case"close":case"request-close":case"toggle-popover":case"hide-popover":case"show-popover":case"toggle-openable":case"close-openable":case"open-openable":case"toggle":case"open":case"show-picker":case"play-pause":case"pause":case"play":case"toggle-muted":case"toggle-fullscreen":case"request-fullscreen":case"exit-fullscreen":case"copy-text":case"share":case"step-up":case"step-down":return t}return""},set(e){this.setAttribute("command",e)}},invokeAction:{enumerable:!1,configurable:!0,get(){throw new Error("invokeAction is deprecated. It has been renamed to command")},set(e){throw new Error("invokeAction is deprecated. It has been renamed to command")}},invokeTargetElement:{enumerable:!1,configurable:!0,get(){throw new Error("invokeTargetElement is deprecated. It has been renamed to command")},set(e){throw new Error("invokeTargetElement is deprecated. It has been renamed to command")}}})}var _=new WeakMap;Object.defineProperties(HTMLElement.prototype,{oncommand:{enumerable:!0,configurable:!0,get(){return se.takeRecords(),_.get(this)||null},set(s){let e=_.get(this)||null;e&&this.removeEventListener("command",e),typeof s=="object"||typeof s=="function"?s!==null?_.set(this,s):_.delete(this):_.delete(this),typeof s=="function"&&this.addEventListener("command",s)}}});function j(s){for(let e of s){if(typeof Element!="undefined"&&!(e instanceof Element))continue;let t=e.getAttribute("oncommand");if(t!==null&&e.oncommand!==null)try{e.oncommand=new Function("event",t)}catch(r){console.error("Invokers Polyfill: Error parsing oncommand attribute for element:",e,r)}}}var se=new MutationObserver(s=>{for(let e of s){let{target:t}=e;e.type==="childList"?(typeof Element!="undefined"&&t instanceof Element||t&&typeof t.querySelectorAll=="function")&&j(Array.from(t.querySelectorAll("[oncommand]"))):t instanceof HTMLElement&&t.hasAttribute("oncommand")?j([t]):t instanceof HTMLElement&&(t.oncommand=null)}});function qe(s){var o,i,c,d,m,f;if(s.defaultPrevented||s.type!=="click")return;let e=s.target.closest("button[invoketarget], button[invokeaction], input[invoketarget], input[invokeaction]");if(e&&(console.warn("Invokers Polyfill: Elements with `invoketarget` or `invokeaction` are deprecated and should be renamed to use `commandfor` and `command` respectively"),e.matches("input")))throw new Error("Input elements no longer support `commandfor`");let t=s.target.closest("button[commandfor][command]");if(!t)return;if(t.form&&t.getAttribute("type")!=="button"){s.preventDefault(),console.error("Invokers Polyfill: Element with `commandfor` is a form participant. It should explicitly set `type=button` in order for `commandfor` to work. To act as a Submit/Reset button, it must not have command or commandfor attributes.",t);return}if(t.hasAttribute("command")!==t.hasAttribute("commandfor")){let u=t.hasAttribute("command")?"command":"commandfor",h=t.hasAttribute("command")?"commandfor":"command";console.error(`Invokers Polyfill: Element with ${u} attribute must also have a ${h} attribute to function.`,t);return}if(t.command===""){console.warn(`Invokers Polyfill: "${t.getAttribute("command")}" is not a valid command value for element:`,t,"Custom commands must begin with --");return}let r=t.commandForElement;if(!r){console.warn("Invokers Polyfill: commandfor target not found for invoker:",t);return}let n=new P("command",{command:t.command,source:t,cancelable:!0,bubbles:!0,composed:!0});if(r.dispatchEvent(n),n.defaultPrevented)return;let a=n.command.toLowerCase();if(r.matches("[popover]")){let u=r.matches(":popover-open");a==="toggle-popover"?(o=r[u?"hidePopover":"showPopover"])==null||o.call(r,{source:t}):a==="hide-popover"&&u?r.hidePopover():a==="show-popover"&&!u&&((i=r.showPopover)==null||i.call(r,{source:t}))}if(r.localName==="dialog"){let u=r.hasAttribute("open");if(a==="show-modal"&&!u)r.showModal();else if(a==="close"&&u)r.close(t.value);else if(a==="request-close"&&u){let h=new Event("cancel",{cancelable:!0});r.dispatchEvent(h),h.defaultPrevented||r.close(t.value)}}if(r.localName==="details"){let u=r.open;a==="toggle"?r.open=!u:a==="open"&&!u?r.open=!0:a==="close"&&u&&(r.open=!1)}if(a.includes("openable")&&typeof r.toggleOpenable=="function"&&(a==="toggle-openable"?r.toggleOpenable():a==="open-openable"?(c=r.openOpenable)==null||c.call(r):a==="close-openable"&&((d=r.closeOpenable)==null||d.call(r))),(r.localName==="select"||r.localName==="input")&&a==="show-picker")try{typeof r.showPicker=="function"&&document.hasFocus()&&t.ownerDocument.hasFocus()&&r.showPicker()}catch(u){console.warn("Invokers: showPicker failed:",u)}if(r.localName==="video"||r.localName==="audio"){let u=r;a==="play-pause"?u.paused?u.play().catch(()=>{}):u.pause():a==="play"&&u.paused?u.play().catch(()=>{}):a==="pause"&&!u.paused?u.pause():a==="toggle-muted"&&(u.muted=!u.muted)}if(a.includes("fullscreen"))try{a==="toggle-fullscreen"?document.fullscreenElement===r?document.exitFullscreen():(m=r.requestFullscreen)==null||m.call(r):a==="request-fullscreen"&&document.fullscreenElement!==r?(f=r.requestFullscreen)==null||f.call(r):a==="exit-fullscreen"&&document.fullscreenElement===r&&document.exitFullscreen()}catch(u){console.warn("Invokers: Fullscreen operation failed:",u)}if(a==="copy-text")try{let u="";if(r===t?u=t.value||t.textContent||"":u=r.textContent||"",navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(u.trim());else{let h=document.createElement("textarea");h.value=u.trim(),h.style.position="fixed",h.style.opacity="0",document.body.appendChild(h),h.select(),document.execCommand("copy"),document.body.removeChild(h)}}catch(u){console.warn("Invokers: Copy operation failed:",u)}if(a==="share")try{let u="";if(r===t?u=t.value||t.textContent||"":u=r.textContent||"",navigator.share){let h=u.trim();h.startsWith("http://")||h.startsWith("https://")?navigator.share({url:h}):navigator.share({text:h})}}catch(u){console.warn("Invokers: Share operation failed:",u)}if(r.localName==="input"&&r.type==="number"){let u=r;try{a==="step-up"?u.stepUp():a==="step-down"&&u.stepDown()}catch(h){console.warn("Invokers: Step operation failed:",h)}}}function ye(s){s.addEventListener("click",qe,!0)}function _e(s,e){let t=s.prototype.attachShadow;s.prototype.attachShadow=function(n){let a=t.call(this,n);return e(a),a};let r=s.prototype.attachInternals;s.prototype.attachInternals=function(){let n=r.call(this);return n.shadowRoot&&e(n.shadowRoot),n}}function je(){let s=typeof window!="undefined"?window:globalThis;Ue()||s.CommandEvent!==P&&(document.addEventListener("invoke",e=>{e.type==="invoke"&&e.isTrusted&&(e.stopImmediatePropagation(),e.preventDefault())},!0),document.addEventListener("command",e=>{e.type==="command"&&e.isTrusted&&!e.defaultPrevented&&e.eventPhase===Event.AT_TARGET&&(e.stopImmediatePropagation(),e.preventDefault())},!0),ae(HTMLButtonElement),ae(HTMLInputElement),ae(HTMLTextAreaElement),_e(HTMLElement,e=>{ye(e),se.observe(e,{subtree:!0,childList:!0,attributeFilter:["oncommand"]}),j(Array.from(e.querySelectorAll("[oncommand]")))}),ye(document),se.observe(document,{subtree:!0,childList:!0,attributeFilter:["oncommand"]}),j(Array.from(document.querySelectorAll("[oncommand]"))),typeof s.CommandEvent=="undefined"?Object.defineProperty(s,"CommandEvent",{value:P,configurable:!0,writable:!0,enumerable:!1}):console.warn("Invokers Polyfill: `CommandEvent` already exists. The polyfill's CommandEvent will not overwrite it."),typeof s.InvokeEvent=="undefined"&&Object.defineProperty(s,"InvokeEvent",{value:oe,configurable:!0,writable:!0,enumerable:!1}))}je();var Be=[[1,/^[0-9]+(\.[0-9]+)?(?:[eE][+-]?[0-9]+)?/],[2,/^'(?:[^'\\]|\\.)*'|^"(?:[^"\\]|\\.)*"/],[5,/^(true|false)\b/],[6,/^null\b/],[0,/^[a-zA-Z_$][a-zA-Z0-9_$]*/],[3,/^(===|!==|==|!=|<=|>=|&&|\|\||[<>\+\-\*\/%?!])/],[4,/^\./],[7,/^\(/],[8,/^\)/],[9,/^\[/],[10,/^\]/],[11,/^:/]],O=class O{tokenize(e){if(typeof e!="string")throw new Error("Invokers Expression Error: Expression must be a string");if(e.length>O.MAX_EXPRESSION_LENGTH)throw new Error(`Invokers Expression Error: Expression too long (max ${O.MAX_EXPRESSION_LENGTH} characters)`);if(e.includes("\0")||e.includes("\u2028")||e.includes("\u2029"))throw new Error("Invokers Expression Error: Expression contains invalid characters");let t=[/eval\s*\(/i,/Function\s*\(/i,/setTimeout\s*\(/i,/setInterval\s*\(/i,/XMLHttpRequest/i,/fetch\s*\(/i,/import\s*\(/i,/require\s*\(/i,/process\./i,/globalThis\./i,/window\./i,/document\./i,/console\./i,/alert\s*\(/i,/prompt\s*\(/i,/confirm\s*\(/i];for(let a of t)if(a.test(e))throw new Error("Invokers Expression Error: Expression contains potentially unsafe operations");let r=[],n=0;for(;n<e.length;){if(r.length>=O.MAX_TOKEN_COUNT)throw new Error(`Invokers Expression Error: Expression too complex (max ${O.MAX_TOKEN_COUNT} tokens)`);if(/\s/.test(e[n])){n++;continue}let a=!1;for(let[o,i]of Be){let c=e.substring(n).match(i);if(c){if(o===0){let d=c[0];if(this.isDangerousIdentifier(d))throw new Error(`Invokers Expression Error: Access to '${d}' is not allowed`)}r.push({type:o,value:c[0],position:n}),n+=c[0].length,a=!0;break}}if(!a){let o=e[n],i=Math.max(0,n-10),c=Math.min(e.length,n+10),d=e.substring(i,c),m=" ".repeat(n-i)+"^";throw new Error(`Invokers Expression Error: Unexpected character '${o}' at position ${n}
${d}
${m}`)}}return r.push({type:12,value:"",position:n}),r}isDangerousIdentifier(e){return["globalThis","global","self","document","navigator","location","history","localStorage","sessionStorage","indexedDB","cookies","XMLHttpRequest","fetch","WebSocket","process","Buffer","require","module","exports","__dirname","__filename","eval","Function","setTimeout","setInterval","clearTimeout","clearInterval","alert","prompt","confirm","console","debugger","prototype","constructor","innerHTML","outerHTML","innerText","insertAdjacentHTML"].includes(e)||e.startsWith("__")||e.includes("script")||e.includes("javascript")||e.includes("vbscript")}};O.MAX_EXPRESSION_LENGTH=1e4,O.MAX_TOKEN_COUNT=1e3;var G=O;var z=class{constructor(e){this.current=0;this.tokens=e}parse(){let e=this.expression();if(!this.isAtEnd()){let t=this.peek();throw new Error(`Invokers Expression Error: Unexpected token '${t.value}' at position ${t.position}. Expected end of expression.`)}return e}expression(){return this.conditional()}conditional(){let e=this.logicalOr();if(this.match(3,"?")){let t=e,r=this.expression();this.consume(11,"Expected ':' after '?' in conditional expression");let n=this.conditional();return{type:"CONDITIONAL",test:t,consequent:r,alternate:n}}return e}logicalOr(){let e=this.logicalAnd();for(;this.match(3,"||");){let t="||",r=this.logicalAnd();e={type:"BINARY_OP",left:e,operator:t,right:r}}return e}logicalAnd(){let e=this.equality();for(;this.match(3,"&&");){let t="&&",r=this.equality();e={type:"BINARY_OP",left:e,operator:t,right:r}}return e}equality(){let e=this.comparison();for(;this.match(3,"===","!==","==","!=");){let t=this.previous().value,r=this.comparison();e={type:"BINARY_OP",left:e,operator:t,right:r}}return e}comparison(){let e=this.term();for(;this.match(3,"<",">","<=",">=");){let t=this.previous().value,r=this.term();e={type:"BINARY_OP",left:e,operator:t,right:r}}return e}term(){let e=this.factor();for(;this.match(3,"+","-");){let t=this.previous().value,r=this.factor();e={type:"BINARY_OP",left:e,operator:t,right:r}}return e}factor(){let e=this.unary();for(;this.match(3,"*","/","%");){let t=this.previous().value,r=this.unary();e={type:"BINARY_OP",left:e,operator:t,right:r}}return e}unary(){if(this.match(3,"!","-")){let e=this.previous().value,t=this.unary();return{type:"UNARY_OP",operator:e,right:t}}return this.memberAccess()}memberAccess(){let e=this.primary();for(;;)if(this.match(4)){let t=this.consume(0,"Expected property name after '.'").value;e={type:"MEMBER_ACCESS",object:e,property:t}}else if(this.match(9)){let t=this.expression();this.consume(10,"Expected ']' after array index"),e={type:"ARRAY_ACCESS",object:e,index:t}}else break;return e}primary(){if(this.match(1))return{type:"LITERAL",value:parseFloat(this.previous().value)};if(this.match(2))return{type:"LITERAL",value:this.previous().value.slice(1,-1)};if(this.match(5))return{type:"LITERAL",value:this.previous().value==="true"};if(this.match(6))return{type:"LITERAL",value:null};if(this.match(0))return{type:"IDENTIFIER",value:this.previous().value};if(this.match(7)){let e=this.expression();return this.consume(8,"Expected ')' after expression"),e}throw new Error(`Invokers Expression Error: Unexpected token at position ${this.peek().position}: '${this.peek().value}'`)}match(e,...t){if(Array.isArray(e)){for(let r of e)if(this.check(r))return this.advance(),!0;return!1}else return this.check(e)&&(t.length===0||t.includes(this.peek().value))?(this.advance(),!0):!1}consume(e,t){if(this.check(e))return this.advance();throw new Error(`Invokers Expression Error: ${t}. Found '${this.peek().value}' at position ${this.peek().position}`)}check(e){return this.isAtEnd()?!1:this.peek().type===e}advance(){return this.isAtEnd()||this.current++,this.previous()}isAtEnd(){return this.peek().type===12}peek(){return this.tokens[this.current]}previous(){return this.tokens[this.current-1]}};var Y=class Y{constructor(e){this.recursionDepth=0;this.context=this.sanitizeContext(e)}sanitizeContext(e){let t={};for(let[r,n]of Object.entries(e))this.isSafeProperty(r)&&(t[r]=this.sanitizeValue(n));return t}sanitizeValue(e){if(e==null)return e;if(typeof e!="function")return Array.isArray(e)?e.slice(0,1e3):typeof e=="object"&&e!==null?e.constructor!==Object&&!Array.isArray(e)?this.createSafeDOMObject(e):this.sanitizeObject(e,0):e}sanitizeObject(e,t){if(t>50)return{};let r={},n=0;for(let[a,o]of Object.entries(e)){if(n>=50)break;this.isSafeProperty(a)&&(r[a]=this.sanitizeValue(o),n++)}return r}isSafeProperty(e){return!e.startsWith("__")&&!["prototype","constructor","__proto__","window","document","eval","Function"].includes(e)&&e.length<=50}createSafeDOMObject(e){return new Proxy(e,{get:(t,r)=>{if(typeof r=="string"&&this.isSafeProperty(r)){let n=t[r];return typeof n=="function"?void 0:typeof n!="object"||n===null?n:this.sanitizeValue(n)}},set:()=>!1,has:(t,r)=>typeof r=="string"&&this.isSafeProperty(r)&&r in t})}evaluate(e){if(this.recursionDepth>Y.MAX_RECURSION_DEPTH)throw new Error("Invokers Expression Error: Maximum recursion depth exceeded");this.recursionDepth++;try{switch(e.type){case"LITERAL":return e.value;case"IDENTIFIER":return this.resolveIdentifier(e.value);case"BINARY_OP":return this.evaluateBinaryOp(e);case"UNARY_OP":return this.evaluateUnaryOp(e);case"MEMBER_ACCESS":return this.evaluateMemberAccess(e);case"ARRAY_ACCESS":return this.evaluateArrayAccess(e);case"CONDITIONAL":return this.evaluateConditional(e);default:throw new Error(`Invokers Expression Error: Unknown AST node type: ${e.type}`)}}finally{this.recursionDepth--}}evaluateBinaryOp(e){let t=this.evaluate(e.left),r=this.evaluate(e.right),n=e.operator;if(t==null||Number.isNaN(t)||r==null||Number.isNaN(r))switch(n){case"===":return t===r;case"!==":return t!==r;case"==":return t==r;case"!=":return t!=r;case"&&":return t&&r;case"||":return t||r;default:return["+","-","*","/","%"].includes(n)?Number.NaN:!1}switch(n){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":if(r===0)throw new Error("Invokers Expression Error: Division by zero");return t/r;case"%":return t%r;case"===":return t===r;case"!==":return t!==r;case"==":return t==r;case"!=":return t!=r;case"<":return t<r;case">":return t>r;case"<=":return t<=r;case">=":return t>=r;case"&&":return t&&r;case"||":return t||r;default:throw new Error(`Invokers Expression Error: Unknown binary operator: ${n}`)}}evaluateUnaryOp(e){let t=this.evaluate(e.right),r=e.operator;switch(r){case"!":return!t;case"-":return-t;default:throw new Error(`Invokers Expression Error: Unknown unary operator: ${r}`)}}evaluateMemberAccess(e){let t=this.evaluate(e.object);if(t!=null&&(typeof t=="object"||typeof t=="string")){let r=e.property;if(typeof r=="string"&&this.isSafeProperty(r))return t[r]}}evaluateArrayAccess(e){let t=this.evaluate(e.object),r=this.evaluate(e.index);if(typeof r=="string"){if(!this.isSafeProperty(r))return}else if(typeof r=="number"){if(r<0||r>1e4||!Number.isInteger(r))return}else return;if(t&&(typeof t=="object"||Array.isArray(t))&&r in t)return t[r]}resolveIdentifier(e){if(!this.isSafeProperty(e))throw new Error(`Invokers Expression Error: Access to '${e}' is not allowed`);if(e in this.context)return this.context[e]}evaluateConditional(e){return this.evaluate(e.test)?this.evaluate(e.consequent):this.evaluate(e.alternate)}};Y.MAX_RECURSION_DEPTH=100;var K=Y;var ie=class{constructor(e=100){this.cache=new Map;this.maxSize=e}get(e){let t=this.cache.get(e);return t!==void 0&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){let r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}this.cache.set(e,t)}clear(){this.cache.clear()}},Ee=new ie,U=class U{constructor(){this.evaluations=[]}canEvaluate(){let e=Date.now();return this.evaluations=this.evaluations.filter(t=>e-t<U.WINDOW_SIZE_MS),this.evaluations.length>=U.MAX_EVALUATIONS_PER_SECOND?!1:(this.evaluations.push(e),!0)}};U.MAX_EVALUATIONS_PER_SECOND=1e3,U.WINDOW_SIZE_MS=1e3;var ce=U,We=new ce;function we(s,e){if(!We.canEvaluate()){console.warn("Invokers: Expression evaluation rate limit exceeded");return}try{let t=Ee.get(s);if(!t){let a=new G().tokenize(s);t=new z(a).parse(),Ee.set(s,t)}return new K(e).evaluate(t)}catch(t){let r=t instanceof Error?t.message:String(t);if(r.includes("not allowed")||r.includes("potentially unsafe")||r.includes("invalid characters")||r.includes("Maximum recursion depth")||r.includes("Expression too"))throw t;if(r.includes("Maximum call stack"))throw new Error("Invokers Expression Error: Maximum recursion depth exceeded");console.error(`Invokers Expression Error in "${s}": ${r}`);return}}function be(s="invoker",e=8){let t="";if(typeof crypto!="undefined"&&crypto.getRandomValues){let r=new Uint8Array(e);crypto.getRandomValues(r),t=Array.from(r,n=>n.toString(36)).join("").slice(0,e)}else t=Math.random().toString(36).substring(2,2+e);return`${s}-${t}`}function H(s,e){if(typeof s!="string")return"";s.length>1e4&&(console.warn("Invokers: Template too large, truncating"),s=s.substring(0,1e4));let t=s,r=0;return t=t.replace(/\{\{(.*?)\}\}/g,(n,a)=>{if(r++,r>50)return console.warn("Invokers: Too many interpolations in template, stopping"),"";try{if(a.trim()==="__uid")return be();let o=we(a.trim(),e);return o!=null?String(o):""}catch(o){return console.warn(`Invokers: Expression evaluation failed in interpolation: ${a}`,o),""}}),t}function k(s,e){let t=s.trim();if(t.startsWith("@")){let n=t.match(/^@([a-z]+)\((.*)\)$/);if(n){let a=n[1],o=n[2];switch(o=o.replace(/\\([()])/g,"$1"),a){case"closest":let i=e.closest(o);return i?[i]:[];case"child":let c=e.querySelector(o);return c?[c]:[];case"children":return Array.from(e.querySelectorAll(o));default:return console.warn(`Invokers: Unknown contextual selector type "@${a}".`),[]}}return[]}if(t.startsWith("#")){let n=document.querySelector(t);return n?[n]:[]}let r=document.getElementById(t);if(r)return[r];try{return Array.from(document.querySelectorAll(t))}catch(n){return console.error(`Invokers: Invalid CSS selector in commandfor: "${t}"`,n),[]}}var Z={"--media:toggle":async({invoker:s,targetElement:e})=>{let t=M(e,{tagName:["video","audio"]});if(t.length>0)throw l(`Media command failed: ${t.join(", ")}`,"error",{command:"--media:toggle",element:s,recovery:"Ensure commandfor points to a <video> or <audio> element."});let r=e,n=s.dataset.playText||"Pause",a=s.dataset.pauseText||"Play";try{r.paused?(await r.play(),s.textContent=n,s.setAttribute("aria-pressed","true")):(r.pause(),s.textContent=a,s.setAttribute("aria-pressed","false"))}catch(o){throw l("Failed to toggle media playback","error",{command:"--media:toggle",element:s,cause:o,recovery:o.name==="NotAllowedError"?"Media autoplay blocked by browser. User interaction may be required.":"Check that the media element has a valid source and is ready to play."})}},"--media:seek":({invoker:s,targetElement:e,params:t})=>{let r=M(e,{tagName:["video","audio"]});if(r.length>0)throw l(`Media command failed: ${r.join(", ")}`,"error",{command:"--media:seek",element:s,recovery:"Ensure commandfor points to a <video> or <audio> element."});let n=e,a=parseFloat(t[0]);if(isNaN(a))throw l("Media seek command requires a numeric value for seconds","error",{command:"--media:seek",element:s,context:{provided:t[0]},recovery:"Use format: --media:seek:10 (for 10s) or --media:seek:-5 (for -5s)."});n.currentTime=Math.max(0,Math.min(n.duration,n.currentTime+a))},"--media:mute":({invoker:s,targetElement:e})=>{let t=M(e,{tagName:["video","audio"]});if(t.length>0)throw l(`Media command failed: ${t.join(", ")}`,"error",{command:"--media:mute",element:s,recovery:"Ensure commandfor points to a <video> or <audio> element."});let r=e;r.muted=!r.muted,s.setAttribute("aria-pressed",String(r.muted))},"--carousel:nav":({invoker:s,targetElement:e,params:t})=>{let[r]=t;if(r!=="next"&&r!=="prev")throw l('Carousel nav requires a direction parameter of "next" or "prev"',"error",{command:"--carousel:nav",element:s,recovery:"Use format: --carousel:nav:next or --carousel:nav:prev"});let n=Array.from(e.children);if(n.length<2)return;let a=n.findIndex(d=>!d.hasAttribute("hidden")),o=a===-1?0:a,i=(r==="next"?o+1:o-1+n.length)%n.length,c=()=>{n.forEach((d,m)=>{d.toggleAttribute("hidden",m!==i)})};document.startViewTransition?document.startViewTransition(c):c()},"--clipboard:copy":async({invoker:s,targetElement:e})=>{if(!navigator.clipboard)throw l("Clipboard API not available","error",{command:"--clipboard:copy",element:s,recovery:"This feature requires a secure context (HTTPS)."});let t=s.textContent||"",r=s.dataset.feedbackText||"Copied!",n=s.dataset.errorText||"Error!",a=e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e.value:e.textContent||"";s.setAttribute("disabled","");try{await navigator.clipboard.writeText(a),s.textContent=r}catch(o){throw s.textContent=n,l("Failed to copy text to clipboard","error",{command:"--clipboard:copy",element:s,cause:o})}finally{setTimeout(()=>{s.textContent=t,s.removeAttribute("disabled")},2e3)}},"--form:reset":({invoker:s,targetElement:e})=>{let t=M(e,{tagName:["form"]});if(t.length>0)throw l(`Form reset failed: ${t.join(", ")}`,"error",{command:"--form:reset",element:s,recovery:"Ensure commandfor points to a <form> element."});e.reset()},"--form:submit":({invoker:s,targetElement:e})=>{let t=M(e,{tagName:["form"]});if(t.length>0)throw l(`Form submit failed: ${t.join(", ")}`,"error",{command:"--form:submit",element:s,recovery:"Ensure commandfor points to a <form> element."});e.requestSubmit()},"--input:step":({invoker:s,targetElement:e,params:t})=>{if(!(e instanceof HTMLInputElement)||e.type!=="number")throw l('Input step target must be an <input type="number">',"error",{command:"--input:step",element:s});let r=parseFloat(t[0]||"1");if(isNaN(r))throw l("Input step requires a valid numeric parameter","error",{command:"--input:step",element:s,context:{provided:t[0]},recovery:"Use --input:step:1 or --input:step:-1"});r>0?e.stepUp(r):r<0&&e.stepDown(Math.abs(r)),e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))},"--scroll:to":({targetElement:s})=>{s.scrollIntoView({behavior:"smooth",block:"start"})},"--dom:remove":({targetElement:s})=>{let e=()=>s.remove();document.startViewTransition?document.startViewTransition(e):e()},"--dom:replace":({invoker:s,targetElement:e,params:t})=>{let r=t[0]||"outer",n=B(s,"replace").cloneNode(!0);N()&&(n=V(n,s));let a=()=>{r==="inner"?e.replaceChildren(n):e.replaceWith(n)};document.startViewTransition?document.startViewTransition(a):a()},"--dom:swap":({invoker:s,targetElement:e,params:t})=>{let[r="inner"]=t,n=B(s,"swap").cloneNode(!0);if(N()){let o={this:{...s,dataset:{...s.dataset},value:s.value||""},data:document.body.dataset,event:s.triggeringEvent},i=document.createElement("div");i.appendChild(n.cloneNode(!0));let c=i.innerHTML,d=H(c,o);i.innerHTML=d;let m=document.createDocumentFragment();for(;i.firstChild;)m.appendChild(i.firstChild);n=V(m,s)}let a=()=>{r==="outer"?e.replaceWith(n):e.replaceChildren(n)};document.startViewTransition?document.startViewTransition(a):a()},"--dom:append":({invoker:s,targetElement:e,params:t})=>{let r=t[0]||"inner",n=B(s,"append").cloneNode(!0);N()&&(n=V(n,s));let a=()=>{r==="outer"?e.after(n):e.append(n)};document.startViewTransition?document.startViewTransition(a):a()},"--dom:prepend":({invoker:s,targetElement:e,params:t})=>{let r=t[0]||"inner",n=B(s,"prepend").cloneNode(!0);N()&&(n=V(n,s));let a=()=>{r==="outer"?e.before(n):e.prepend(n)};document.startViewTransition?document.startViewTransition(a):a()},"--dom:wrap":({invoker:s,targetElement:e,params:t})=>{let r=t[0]||null,n;if(r){n=document.createElement(r);let o=s.dataset.wrapperClass,i=s.dataset.wrapperId;o&&(n.className=o),i&&(n.id=i)}else{let o=B(s,"wrap").cloneNode(!0);N()&&(o=V(o,s));let i=Array.from(o.children);if(i.length!==1)throw l("Wrap template must contain exactly one root element","error",{command:"--dom:wrap",element:s});n=i[0]}let a=()=>{e.replaceWith(n),n.appendChild(e)};document.startViewTransition?document.startViewTransition(a):a()},"--dom:unwrap":({targetElement:s})=>{let e=s.parentElement;if(!e)return;let t=()=>{e.replaceWith(s)};document.startViewTransition?document.startViewTransition(t):t()},"--dom:toggle-empty-class":({targetElement:s,params:e})=>{let t=e[0];if(!t)throw l("Toggle empty class command requires a class name parameter","error",{command:"--dom:toggle-empty-class",element:s});let r=s.children.length>0;s.classList.toggle(t,!r)},"--data:set":({invoker:s,targetElement:e,params:t})=>{let r=t[0],n=t[1];if(!r)throw l("Data set command requires a key parameter","error",{command:"--data:set",element:s});if(N()&&n){let a={this:{...s,dataset:{...s.dataset},value:s.value||""},data:document.body.dataset,event:s.triggeringEvent};n=H(n,a)}e.dataset[r]=n||""},"--data:copy":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Data copy command requires a key parameter","error",{command:"--data:copy",element:s});let n=s.dataset.copyFrom,a=s;if(n&&(a=document.querySelector(n),!a))throw l(`Source element with selector "${n}" not found`,"error",{command:"--data:copy",element:s});let o=a.dataset[r];o!==void 0&&(e.dataset[r]=o)},"--data:set:array:push":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array push command requires an array key parameter","error",{command:"--data:set:array:push",element:s});let n=s.dataset.value;if(!n)throw l("Array push command requires a data-value attribute","error",{command:"--data:set:array:push",element:s});let a=[];try{let o=e.dataset[r];a=o?JSON.parse(o):[]}catch(o){a=[]}try{let o=JSON.parse(n);a.push(o),e.dataset[r]=JSON.stringify(a)}catch(o){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:push",element:s})}},"--data:set:array:remove":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array remove command requires an array key parameter","error",{command:"--data:set:array:remove",element:s});let n=parseInt(s.dataset.index||"0",10);if(isNaN(n))throw l("Array remove command requires a valid data-index attribute","error",{command:"--data:set:array:remove",element:s});let a=[];try{let o=e.dataset[r];a=o?JSON.parse(o):[]}catch(o){a=[]}n>=0&&n<a.length&&(a.splice(n,1),e.dataset[r]=JSON.stringify(a))},"--data:set:array:update":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array update command requires an array key parameter","error",{command:"--data:set:array:update",element:s});let n=parseInt(s.dataset.index||"0",10),a=s.dataset.value;if(isNaN(n))throw l("Array update command requires a valid data-index attribute","error",{command:"--data:set:array:update",element:s});if(!a)throw l("Array update command requires a data-value attribute","error",{command:"--data:set:array:update",element:s});let o=[];try{let i=e.dataset[r];o=i?JSON.parse(i):[]}catch(i){o=[]}if(n>=0&&n<o.length)try{let i=JSON.parse(a);o[n]={...o[n],...i},e.dataset[r]=JSON.stringify(o)}catch(i){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:update",element:s})}},"--data:set:array:insert":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array insert command requires an array key parameter","error",{command:"--data:set:array:insert",element:s});let n=parseInt(s.dataset.index||"0",10),a=s.dataset.value;if(isNaN(n))throw l("Array insert command requires a valid data-index attribute","error",{command:"--data:set:array:insert",element:s});if(!a)throw l("Array insert command requires a data-value attribute","error",{command:"--data:set:array:insert",element:s});let o=[];try{let i=e.dataset[r];o=i?JSON.parse(i):[]}catch(i){o=[]}if(n>=0&&n<=o.length)try{let i=JSON.parse(a);o.splice(n,0,i),e.dataset[r]=JSON.stringify(o)}catch(i){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:insert",element:s})}},"--data:set:array:unshift":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array unshift command requires an array key parameter","error",{command:"--data:set:array:unshift",element:s});let n=s.dataset.value;if(!n)throw l("Array unshift command requires a data-value attribute","error",{command:"--data:set:array:unshift",element:s});let a=[];try{let o=e.dataset[r];a=o?JSON.parse(o):[]}catch(o){a=[]}try{let o=JSON.parse(n);a.unshift(o),e.dataset[r]=JSON.stringify(a)}catch(o){throw l("Invalid JSON in data-value attribute","error",{command:"--data:set:array:unshift",element:s})}},"--data:set:array:clear":({targetElement:s,params:e})=>{let t=e[0];if(!t)throw l("Array clear command requires an array key parameter","error",{command:"--data:set:array:clear",element:s});s.dataset[t]=JSON.stringify([])},"--data:set:array:sort":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array sort command requires an array key parameter","error",{command:"--data:set:array:sort",element:s});let n=s.dataset.sortBy||s.dataset.sort_by,a=s.dataset.sortOrder||s.dataset.sort_order||"asc";if(!n)throw l("Array sort command requires a data-sort-by attribute","error",{command:"--data:set:array:sort",element:s});let o=[];try{let i=e.dataset[r];o=i?JSON.parse(i):[]}catch(i){o=[]}o.sort((i,c)=>{let d=i[n],m=c[n],f=0;return d<m?f=-1:d>m&&(f=1),a==="desc"?-f:f}),e.dataset[r]=JSON.stringify(o)},"--data:set:array:filter":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Array filter command requires an array key parameter","error",{command:"--data:set:array:filter",element:s});let n=s.dataset.filterBy||s.dataset.filter_by,a=s.dataset.filterValue||s.dataset.filter_value,o=s.dataset.resultKey||s.dataset.result_key||`${r}-filtered`;if(!n)throw l("Array filter command requires a data-filter-by attribute","error",{command:"--data:set:array:filter",element:s});let i=[];try{let d=e.dataset[r];i=d?JSON.parse(d):[]}catch(d){i=[]}let c=i.filter(d=>{let m=d[n];return a==="true"?m===!0:a==="false"?m===!1:String(m)===a});e.dataset[o]=JSON.stringify(c)},"--data:set:new-todo":({invoker:s,targetElement:e})=>{let t=Ve(s),r={id:Je(),title:t.title||"",description:t.description||"",priority:t.priority||"medium",tags:t.tags||"",completed:!1,created:new Date().toLocaleDateString()},n=[];try{let a=e.dataset.todos;n=a?JSON.parse(a):[]}catch(a){n=[]}n.push(r),e.dataset.todos=JSON.stringify(n),e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:filter:status":({invoker:s,targetElement:e})=>{let t=s.value;e.dataset.filterStatus=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:filter:priority":({invoker:s,targetElement:e})=>{let t=s.value;e.dataset.filterPriority=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:search":({invoker:s,targetElement:e})=>{let t=s.value;e.dataset.searchTerm=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:sort:by":({invoker:s,targetElement:e})=>{let t=s.value;e.dataset.sortBy=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:sort:order":({invoker:s,targetElement:e})=>{let t=s.value;e.dataset.sortOrder=t,e.dispatchEvent(new CustomEvent("filter-changed",{bubbles:!0}))},"--data:set:toggle":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Toggle command requires a todo ID parameter","error",{command:"--data:set:toggle",element:s});let n=[];try{let o=e.dataset.todos;n=o?JSON.parse(o):[]}catch(o){n=[]}let a=n.findIndex(o=>o.id===r);a!==-1&&(n[a].completed=!n[a].completed,e.dataset.todos=JSON.stringify(n),e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0})))},"--data:set:edit":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Edit command requires a todo ID parameter","error",{command:"--data:set:edit",element:s});e.dataset.editingId=r,e.dispatchEvent(new CustomEvent("edit-mode-changed",{bubbles:!0}))},"--data:set:delete":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Delete command requires a todo ID parameter","error",{command:"--data:set:delete",element:s});let n=[];try{let o=e.dataset.todos;n=o?JSON.parse(o):[]}catch(o){n=[]}let a=n.filter(o=>o.id!==r);e.dataset.todos=JSON.stringify(a),e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:cancel-edit":({invoker:s,targetElement:e,params:t})=>{if(!t[0])throw l("Cancel edit command requires a todo ID parameter","error",{command:"--data:set:cancel-edit",element:s});delete e.dataset.editingId,e.dispatchEvent(new CustomEvent("edit-mode-changed",{bubbles:!0}))},"--data:set:save-edit":({invoker:s,targetElement:e,params:t})=>{let r=t[0];if(!r)throw l("Save edit command requires a todo ID parameter","error",{command:"--data:set:save-edit",element:s});let n=document.getElementById(`edit-form-${r}`);if(!n)throw l(`Edit form for id ${r} not found`,"error",{command:"--data:set:save-edit",element:s});let a={title:n.dataset.title||"",description:n.dataset.description||"",priority:n.dataset.priority||"medium"},o=[];try{let c=e.dataset.todos;o=c?JSON.parse(c):[]}catch(c){o=[]}let i=o.findIndex(c=>c.id===r);i!==-1&&(o[i]={...o[i],...a},e.dataset.todos=JSON.stringify(o),delete e.dataset.editingId,e.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0})))},"--data:set:bulk-action:complete-all":({targetElement:s})=>{let e=[];try{let r=s.dataset.todos;e=r?JSON.parse(r):[]}catch(r){e=[]}let t=e.map(r=>r.completed?r:{...r,completed:!0});s.dataset.todos=JSON.stringify(t),s.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:bulk-action:clear-completed":({targetElement:s})=>{let e=[];try{let r=s.dataset.todos;e=r?JSON.parse(r):[]}catch(r){e=[]}let t=e.filter(r=>!r.completed);s.dataset.todos=JSON.stringify(t),s.dispatchEvent(new CustomEvent("todo-updated",{bubbles:!0}))},"--data:set:bulk-action:export":({targetElement:s})=>{let e=[];try{let o=s.dataset.todos;e=o?JSON.parse(o):[]}catch(o){e=[]}let t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download=`todos-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)},"--cookie:set":({invoker:s,params:e})=>{let t=e[0],r=e[1];if(!t)throw l("Cookie set command requires a key parameter","error",{command:"--cookie:set",element:s});let n=`${encodeURIComponent(t)}=${encodeURIComponent(r||"")}`,a=s.dataset.cookieExpires;if(a){let o=parseInt(a,10);if(!isNaN(o)){let i=new Date;i.setTime(i.getTime()+o*24*60*60*1e3),n+=`; expires=${i.toUTCString()}`}}n+="; path=/",document.cookie=n},"--cookie:get":({targetElement:s,params:e})=>{let t=e[0];if(!t)throw l("Cookie get command requires a key parameter","error",{command:"--cookie:get",element:s});let r=document.cookie.split(";");for(let n of r){let[a,o]=n.trim().split("=");if(decodeURIComponent(a)===t){s.textContent=decodeURIComponent(o||"");return}}s.textContent=""},"--cookie:remove":({params:s})=>{let e=s[0];if(!e)throw l("Cookie remove command requires a key parameter","error",{command:"--cookie:remove"});document.cookie=`${encodeURIComponent(e)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`},"--command:trigger":({targetElement:s,params:e})=>{let t=e[0]||"click",r=new Event(t,{bubbles:!0,cancelable:!0});s.dispatchEvent(r)},"--command:delay":({params:s})=>{let e=parseInt(s[0],10);if(isNaN(e)||e<0)throw l("Delay command requires a valid positive number of milliseconds","error",{command:"--command:delay"});return new Promise(t=>setTimeout(t,e))},"--on:interval":({invoker:s,targetElement:e,params:t})=>{let r=parseInt(t[0],10);if(isNaN(r)||r<=0)throw l("Interval command requires a valid positive interval in milliseconds","error",{command:"--on:interval",element:s});let n=s.dataset.intervalCommand;if(!n)throw l("Interval command requires data-interval-command attribute","error",{command:"--on:interval",element:s});let a=s._invokerIntervalId;a&&clearInterval(a);let o=setInterval(()=>{if(window.Invoker){let c=e.id||`__invoker-target-${Date.now()}`;e.id||(e.id=c),window.Invoker.executeCommand(n,c,s)}},r);s._invokerIntervalId=o;let i=new MutationObserver(()=>{document.contains(s)||(clearInterval(o),i.disconnect())});i.observe(document.body,{childList:!0,subtree:!0})},"--bind":({invoker:s,targetElement:e,params:t})=>{let r=t.join(":");if(!r)throw l("Bind command requires a source property (e.g., value, text, data:name)","error",{command:"--bind",element:s});let n,a=r==="value"&&(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement)?s:e;if(r==="value"&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement))n=a.value;else if(r==="text")n=a.textContent;else if(r==="html")n=a.innerHTML;else if(r.startsWith("attr:")){let d=r.substring(5);n=a.getAttribute(d)}else if(r.startsWith("data:")){let d=r.substring(5).replace(/-([a-z])/g,(m,f)=>f.toUpperCase());n=a.dataset[d]}else throw l(`Invalid source property for --bind: "${r}"`,"error",{command:"--bind",element:s});let o=s.dataset.bindTo,i=o?k(o,s):[e],c=s.dataset.bindAs||"text";i.forEach(d=>{if(c==="value"&&(d instanceof HTMLInputElement||d instanceof HTMLTextAreaElement||d instanceof HTMLSelectElement))d.value=n||"";else if(c==="text")d.textContent=n||"";else if(c==="html")d.innerHTML=le(n||"");else if(c.startsWith("attr:")){let m=c.substring(5);n==null?d.removeAttribute(m):d.setAttribute(m,n)}else if(c.startsWith("data:")){let m=c.substring(5).replace(/-([a-z])/g,(f,u)=>u.toUpperCase());n==null?delete d.dataset[m]:d.dataset[m]=n}else c==="class:add"?n&&d.classList.add(n):c==="class:remove"&&n&&d.classList.remove(n)})},"--text:copy":s=>{let{invoker:e,targetElement:t}=s,r=e.dataset.copyFrom,n=e;if(r&&(n=document.querySelector(r),!n))throw l(`Source element with selector "${r}" not found`,"error",{command:"--text:copy",element:e});let a=n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement?n.value:n.textContent||"";t.textContent=a},"--text:set":({targetElement:s,params:e})=>{s.textContent=e.join(":")},"--attr:set":({targetElement:s,params:e})=>{let t=e[0],r=e.slice(1).join(":");s.setAttribute(t,r)},"--attr:remove":({targetElement:s,params:e})=>{let t=e[0];s.removeAttribute(t)},"--fetch:get":async({invoker:s,targetElement:e})=>{let t=s.dataset.url;if(!t)throw l("Fetch GET command requires a data-url attribute","error",{command:"--fetch:get",element:s,recovery:'Add data-url="/your/endpoint" to the button.'});let r={this:{...s,value:s.value||""},event:s.triggeringEvent};t=H(t,r);let n=new CustomEvent("fetch:before",{detail:{url:t,invoker:s},cancelable:!0});if(window.dispatchEvent(n),n.defaultPrevented){W(s,!1);return}W(s,!0),X(s,e,"data-loading-template");try{let a=new AbortController,o=setTimeout(()=>a.abort(),3e4),i=await fetch(t,{method:"GET",headers:{Accept:"text/html",...xe(s)},signal:a.signal});if(clearTimeout(o),!i.ok)throw l(`HTTP Error: ${i.status} ${i.statusText}`,"error",{command:"--fetch:get",element:s,context:{url:t,status:i.status}});let c=await i.text(),d=Re(c),m=()=>e.replaceChildren(d);await(document.startViewTransition?document.startViewTransition(m).finished:Promise.resolve(m()))}catch(a){throw X(s,e,"data-error-template"),a instanceof Error&&"severity"in a?a:l("Fetch GET failed","error",{command:"--fetch:get",element:s,cause:a,context:{url:t},recovery:"Check the URL, network connection, and server response."})}finally{W(s,!1)}},"--fetch:send":async({invoker:s,targetElement:e})=>{let t=M(e,{tagName:["form"]});if(t.length>0)throw l(`Fetch send failed: ${t.join(", ")}`,"error",{command:"--fetch:send",element:s,recovery:"Ensure commandfor points to a <form> element."});let r=e,n=s.dataset.responseTarget,a=n?document.querySelector(n):r;if(!a)throw l(`Response target "${n}" not found`,"error",{command:"--fetch:send",element:s});W(s,!0),X(s,a,"data-loading-template");try{let o=await fetch(r.action,{method:r.method||"POST",body:new FormData(r),headers:xe(s)});if(!o.ok)throw new Error(`HTTP Error: ${o.status} ${o.statusText}`);let i=await o.text(),c=Re(i),d=()=>a.replaceChildren(c);await(document.startViewTransition?document.startViewTransition(d).finished:Promise.resolve(d()))}catch(o){throw X(s,a,"data-error-template"),l("Fetch send failed","error",{command:"--fetch:send",element:s,cause:o,recovery:"Check the form action, network connection, and server response."})}finally{W(s,!1)}},"--navigate:to":s=>{var t;let e=s.params.join(":");if(!e)throw l("Navigate command requires a URL parameter","error",{command:"--navigate:to",element:s.invoker,recovery:"Use format: --navigate:to:/your/path"});(t=window.history)!=null&&t.pushState?(window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}))):window.location.href=e},"--emit":({params:s,targetElement:e})=>{let[t,...r]=s;if(!t)throw l("Emit command requires an event type parameter","error",{command:"--emit",recovery:"Use format: --emit:event-type or --emit:event-type:detail"});let n=r.length>0?r.join(":"):void 0;if(typeof n=="string"&&(n.startsWith("{")||n.startsWith("[")))try{n=JSON.parse(n)}catch(o){}let a=new CustomEvent(t,{bubbles:!0,composed:!0,detail:n});(e||document.body).dispatchEvent(a)}};function B(s,e){let t=s.dataset.templateId;if(t){let r=document.getElementById(t);if(!(r instanceof HTMLTemplateElement))throw l(`Source <template> with ID "${t}" not found`,"error",{command:`--dom:${e}`,element:s});return r.content}throw l(`DOM command --dom:${e} requires a data-template-id attribute`,"error",{command:`--dom:${e}`,element:s})}function W(s,e){s.toggleAttribute("disabled",e),s.setAttribute("aria-busy",String(e))}function X(s,e,t){let r=t.replace("data-","").replace(/-(\w)/g,(o,i)=>i.toUpperCase()),n=s.dataset[r];if(!n||!e)return;let a=document.getElementById(n);if(!(a instanceof HTMLTemplateElement)){let o=l(`Feedback template "#${n}" not found or is not a <template>`,"warning",{element:s});console.error(o);return}e.replaceChildren(a.content.cloneNode(!0))}function Ve(s){let e={},t=new FormData(s);for(let[r,n]of t.entries())e[r]=n;return e}function Je(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function Re(s){let e=le(s),t=new DOMParser().parseFromString(e,"text/html"),r=document.createDocumentFragment();return r.append(...Array.from(t.body.childNodes)),r}function V(s,e){let t=e.dataset.withJson;if(!t)return s;let r=document.getElementById("text-input"),n={this:{...e,value:(r==null?void 0:r.value)||""},event:e.triggeringEvent},a;try{a=H(t,n)}catch(c){return console.error("Invokers: Failed to interpolate data-with-json:",c),s}let o;try{o=JSON.parse(a)}catch(c){return console.error("Invokers: Invalid JSON in data-with-json attribute:",c),s}s.querySelectorAll("[data-tpl-text]").forEach(c=>{let d=c.getAttribute("data-tpl-text");if(d&&o.hasOwnProperty(d)){let m=String(o[d]);if(c.children.length===0)c.textContent=m;else{let f=document.createTextNode(m);c.insertBefore(f,c.firstChild)}}}),s.querySelectorAll("[data-tpl-attr]").forEach(c=>{let d=c.getAttribute("data-tpl-attr");d&&d.split(",").forEach(m=>{let[f,u]=m.split(":").map(h=>h.trim());f&&u&&o.hasOwnProperty(u)&&c.setAttribute(f,String(o[u]))})}),s.querySelectorAll("[data-tpl-value]").forEach(c=>{let d=c.getAttribute("data-tpl-value");d&&o.hasOwnProperty(d)&&"value"in c&&(c.value=String(o[d]))});let i=s.firstElementChild;return i!=null&&i.id&&s.querySelectorAll('[commandfor^="@"]').forEach(c=>{let d=c.getAttribute("commandfor");if(d!=null&&d.startsWith("@closest(")){let m=d.match(/^@closest\(([^)]+)\)$/);if(m){let f=m[1];i.matches(f)&&c.setAttribute("commandfor",i.id)}}}),s}function xe(s){let e={};for(let t in s.dataset)if(t.startsWith("header")){let r=t.substring(6).replace(/([A-Z])/g,"-$1").toLowerCase();r&&(e[r]=s.dataset[t])}return e}function Ce(){return typeof HTMLButtonElement!="undefined"&&"interestForElement"in HTMLButtonElement.prototype}var D=class D{constructor(){this.initialized=!1;this.attributeName="interestfor";this.interestEventName="interest";this.loseInterestEventName="loseinterest";this.interestDelayStartProp="--interest-delay-start";this.interestDelayEndProp="--interest-delay-end";this.interestDelayProp="--interest-delay";this.dataField="__interestForData";this.targetDataField="__interestForTargetData";this.invokersWithInterest=new Set;this.touchInProgress=!1;this.InterestState={NoInterest:"none",FullInterest:"full"};this.Source={Hover:"hover",DeHover:"dehover",Focus:"focus",Blur:"blur",Touch:"touch"}}static getInstance(){return D.instance||(D.instance=new D),D.instance}apply(){if(window.interestForPolyfillInstalled)return;window.interestForPolyfillInstalled=!0;let e=Ce();e&&!window.interestForUsePolyfillAlways||(e&&this.disableNativeSupport(),this.setupPolyfill(),this.initialized=!0,console.log(`Interest Invokers polyfill installed (native: ${e}).`))}disableNativeSupport(){let e=t=>{t.isTrusted&&(t.preventDefault(),t.stopImmediatePropagation())};document.body.addEventListener(this.interestEventName,e,{capture:!0}),document.body.addEventListener(this.loseInterestEventName,e,{capture:!0})}setupPolyfill(){this.registerCustomProperties(),this.addEventHandlers(),this.setupElementMixins()}registerCustomProperties(){let e=document.createElement("style");e.textContent=`
      @property ${this.interestDelayStartProp} {
        syntax: "normal | <time>";
        inherits: false;
        initial-value: normal;
      }
      @property ${this.interestDelayEndProp} {
        syntax: "normal | <time>";
        inherits: false;
        initial-value: normal;
      }
      @property ${this.interestDelayProp} {
        syntax: "[ normal | <time> ]{1,2}";
        inherits: false;
        initial-value: normal;
      }
    `,document.head.appendChild(e),document[this.dataField]={globalPropsStyle:e}}setupElementMixins(){this.applyInterestInvokerMixin(HTMLButtonElement),this.applyInterestInvokerMixin(HTMLAnchorElement),this.applyInterestInvokerMixin(HTMLAreaElement),typeof SVGAElement!="undefined"&&this.applyInterestInvokerMixin(SVGAElement)}applyInterestInvokerMixin(e){Object.defineProperty(e.prototype,"interestForElement",{enumerable:!0,configurable:!0,get(){let t=this.getAttribute("interestfor");return t?document.getElementById(t):null},set(t){if(t===null)this.removeAttribute("interestfor");else if(t&&typeof t=="object"&&"id"in t)this.setAttribute("interestfor",t.id||"");else throw new TypeError("interestForElement must be an element or null")}})}addEventHandlers(){document.body.addEventListener("mouseover",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Hover)),document.body.addEventListener("mouseout",e=>this.handleInterestHoverOrFocus(e.target,this.Source.DeHover)),document.body.addEventListener("focusin",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Focus)),document.body.addEventListener("focusout",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Blur)),document.body.addEventListener("keydown",e=>{e.key==="Escape"&&this.invokersWithInterest.forEach(t=>{this.clearState(t)})}),this.setupTouchHandlers()}setupTouchHandlers(){document.body.addEventListener("touchstart",r=>{this.touchInProgress=!0;let n=r.target.closest("button[interestfor]");if(n){this.initializeDataField(n);let a=n[this.dataField];a.longPressTimer=setTimeout(()=>{this.gainOrLoseInterest(n,this.getInterestForTarget(n),this.InterestState.FullInterest),a.longPressTimer=null},500)}});let t=r=>{let n=r.target.closest("button[interestfor]");if(n){let a=n[this.dataField];a!=null&&a.longPressTimer&&(clearTimeout(a.longPressTimer),a.longPressTimer=null)}};document.body.addEventListener("touchend",r=>{t(r),this.touchInProgress=!1}),document.body.addEventListener("touchmove",t)}handleInterestHoverOrFocus(e,t){var o,i,c,d,m,f;if(this.touchInProgress||!e.isConnected)return;if(!this.getInterestForTarget(e)){this.handleUpstreamInterest(e,t);return}if(e instanceof HTMLButtonElement&&e.disabled)return;this.initializeDataField(e);let n=e[this.dataField],a=this.getInterestInvoker(e);t===this.Source.Hover||t===this.Source.Focus?((o=n.clearLostTask)==null||o.call(n),(c=(i=a==null?void 0:a[this.dataField])==null?void 0:i.clearLostTask)==null||c.call(i),this.scheduleInterestGainedTask(e,this.InterestState.FullInterest)):((d=n.clearGainedTask)==null||d.call(n),n.state!==this.InterestState.NoInterest&&this.scheduleInterestLostTask(e),a&&((f=(m=a[this.dataField])==null?void 0:m.clearGainedTask)==null||f.call(m),(t===this.Source.Blur||!e.matches(":hover"))&&this.scheduleInterestLostTask(a)))}handleUpstreamInterest(e,t){var n;let r=e.closest(".interest-target");if(r){let a=this.getInterestInvoker(r);if(a){let o=a[this.dataField];t===this.Source.Hover||t===this.Source.Focus?(n=o==null?void 0:o.clearLostTask)==null||n.call(o):(t===this.Source.Blur||!e.matches(":hover"))&&this.scheduleInterestLostTask(a)}}}gainOrLoseInterest(e,t,r){var n,a;if(!e||!t||!e.isConnected||this.getInterestForTarget(e)!==t||r===this.InterestState.NoInterest&&this.getInterestInvoker(t)!==e)return!1;if(r!==this.InterestState.NoInterest){let o=this.getInterestInvoker(t);if(o){if(o===e)return(a=(n=o[this.dataField])==null?void 0:n.clearLostTask)==null||a.call(n),!1;if(!this.gainOrLoseInterest(o,t,this.InterestState.NoInterest)||!e.isConnected||this.getInterestForTarget(e)!==t)return!1}return this.applyState(e,r)}return this.clearState(e),!0}applyState(e,t){let r=e[this.dataField],n=this.getInterestForTarget(e);if(!n)return!1;switch(t){case this.InterestState.FullInterest:if(r.state!==this.InterestState.NoInterest)throw new Error("Invalid state");let a=new CustomEvent(this.interestEventName,{bubbles:!0,cancelable:!0});Object.defineProperty(a,"source",{value:e,writable:!1}),n.dispatchEvent(a),e.dispatchEvent(new CustomEvent("interest:shown",{bubbles:!0,detail:{target:n,source:e}}));try{n.hasAttribute("popover")&&typeof n.showPopover=="function"&&(n.showPopover(),this.supportsAnchorPositioning()||requestAnimationFrame(()=>this.positionPopover(e,n)))}catch(o){}if(r.state=this.InterestState.FullInterest,n[this.targetDataField]||(n[this.targetDataField]={}),n[this.targetDataField].invoker=e,n.hasAttribute("popover")){let o=this.createPopoverToggleListener();n[this.targetDataField].toggleListener=o,n.addEventListener("toggle",o)}this.invokersWithInterest.add(e),e.classList.add("interest-source"),n.classList.add("interest-target"),this.isPlainHint(n)||e.setAttribute("aria-expanded","true"),this.setupAnchorPositioning(e,n,r);break;default:throw new Error("Invalid state")}return!0}clearState(e){let t=e[this.dataField];if(t&&(clearTimeout(t.gainedTimer),clearTimeout(t.lostTimer),t.state!==this.InterestState.NoInterest)){let r=this.getInterestForTarget(e);if(r){let n=new CustomEvent(this.loseInterestEventName,{bubbles:!0,cancelable:!0});Object.defineProperty(n,"source",{value:e,writable:!1}),r.dispatchEvent(n),e.dispatchEvent(new CustomEvent("interest:lost",{bubbles:!0,detail:{target:r,source:e}}));try{typeof r.hidePopover=="function"&&r.hidePopover()}catch(o){}let a=r[this.targetDataField];a!=null&&a.toggleListener&&r.removeEventListener("toggle",a.toggleListener),r[this.targetDataField]=null,this.invokersWithInterest.delete(e),e.classList.remove("interest-source"),r.classList.remove("interest-target"),this.isPlainHint(r)||e.setAttribute("aria-expanded","false"),this.cleanupAnchorPositioning(e,r,t)}t.state=this.InterestState.NoInterest}}supportsAnchorPositioning(){return"anchorName"in document.body.style}setupAnchorPositioning(e,t,r){let n=`--interest-anchor-${Math.random().toString(36).substring(2)}`;if(e.style.anchorName=n,t.style.positionAnchor=n,r.anchorName=n,this.supportsAnchorPositioning()){let a=`interest-anchored-${Math.random().toString(36).substring(2)}`,o=document.createElement("style");o.textContent=`
      .${a} {
        margin: 0;
        top: calc(anchor(${n} bottom) - 4px);
        left: anchor(${n});
        justify-self: center;
      }
    `,document.head.appendChild(o),t.classList.add(a),r.styleElement=o,r.className=a}}cleanupAnchorPositioning(e,t,r){r.anchorName&&(e.style.anchorName="",t.style.positionAnchor="",r.anchorName=null),r.styleElement&&(r.styleElement.remove(),r.styleElement=null),r.className&&(t.classList.remove(r.className),r.className=null),t.style.position="",t.style.top="",t.style.left="",t.style.zIndex=""}positionPopover(e,t){let r=e.getBoundingClientRect(),n=t.getBoundingClientRect(),a=window.innerWidth,o=window.innerHeight,i,c;c=r.left+r.width/2-n.width/2,i=r.bottom-4,i+n.height>o&&(i=r.top-n.height+4,i<0&&(i=r.bottom+8));let d=Math.max(8,Math.min(c,a-n.width-8)),m=Math.max(8,Math.min(i,o-n.height-8));t.style.position="fixed",t.style.top=`${m}px`,t.style.left=`${d}px`,t.style.zIndex="9999"}createPopoverToggleListener(){return e=>{let t=e.target;if(e.newState==="closed"){let n=t[this.targetDataField],a=n==null?void 0:n.invoker;a&&this.gainOrLoseInterest(a,t,this.InterestState.NoInterest)}}}scheduleInterestGainedTask(e,t){var a;let r=this.getDelaySeconds(e,this.interestDelayStartProp)*1e3;if(!isFinite(r)||r<0)return;let n=e[this.dataField];(a=n.clearGainedTask)==null||a.call(n),n.gainedTimer=setTimeout(()=>{this.gainOrLoseInterest(e,this.getInterestForTarget(e),t)},r)}scheduleInterestLostTask(e){var n;let t=this.getDelaySeconds(e,this.interestDelayEndProp)*1e3;if(!isFinite(t)||t<0)return;let r=e[this.dataField];(n=r.clearLostTask)==null||n.call(r),r.lostTimer=setTimeout(()=>{this.gainOrLoseInterest(e,this.getInterestForTarget(e),this.InterestState.NoInterest)},t)}getDelaySeconds(e,t){let r=getComputedStyle(e),n=r.getPropertyValue(t).trim();if(n.toLowerCase()!=="normal")return this.parseTimeValue(n);let a=r.getPropertyValue(this.interestDelayProp).trim();if(a&&a.toLowerCase()!=="normal"){let o=a.split(/\s+/).filter(i=>i.length>0);if(o.length>0){let i=o[0],c=o.length>1?o[1]:i,d=t===this.interestDelayStartProp?i:c;if(d.toLowerCase()!=="normal")return this.parseTimeValue(d)}}return t===this.interestDelayStartProp?.5:.25}parseTimeValue(e){let t=String(e).trim(),r=t.match(/^([\d.]+)s$/);if(r)return parseFloat(r[1]);let n=t.match(/^([\d.]+)ms$/);return n?parseFloat(n[1])/1e3:parseFloat(t)||0}initializeDataField(e){if(e[this.dataField])return;e[this.dataField]={state:this.InterestState.NoInterest,gainedTimer:null,lostTimer:null,longPressTimer:null,anchorName:null,clearGainedTask(){clearTimeout(this.gainedTimer)},clearLostTask(){clearTimeout(this.lostTimer)}};let t=this.getInterestForTarget(e);t&&this.setupAccessibility(e,t)}setupAccessibility(e,t){this.isPlainHint(t)?e.setAttribute("aria-describedby",t.id):(e.setAttribute("aria-details",t.id),e.setAttribute("aria-expanded","false"),t.hasAttribute("role")||t.setAttribute("role","tooltip"))}isPlainHint(e){var a,o;if(((a=e.getAttribute("popover"))==null?void 0:a.toLowerCase())!=="hint")return!1;let t=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(",");if(e.querySelector(t))return!1;let r=["h1","h2","h3","h4","h5","h6","ul","ol","li","table","nav","header","footer","main","aside","article","section","form","blockquote","details","summary","dialog"].join(",");if(e.querySelector(r))return!1;let n=e.querySelectorAll("[role]");for(let i of n){let c=(o=i.getAttribute("role"))==null?void 0:o.toLowerCase();if(c&&!["presentation","none","generic","image"].includes(c))return!1}return!0}getInterestForTarget(e){let t=e.getAttribute(this.attributeName);return t?document.getElementById(t):null}getInterestInvoker(e){var n;let t=e[this.targetDataField],r=(t==null?void 0:t.invoker)||null;return r&&((n=r[this.dataField])==null?void 0:n.state)!==this.InterestState.NoInterest?r:null}isInitialized(){return this.initialized}};D.instance=null;var de=D;function Ie(){let s=de.getInstance();document.readyState==="complete"?s.apply():window.addEventListener("load",()=>s.apply())}function Ge(s,e){let t=new CustomEvent(s,{bubbles:!1,cancelable:!1});return Object.defineProperty(t,"source",{value:e||null,writable:!1,enumerable:!0}),t;return t}Ie();function Q(s){var n;let e=[],t="",r=0;for(;r<s.length;){let a=s[r];a==="\\"?(t+=(n=s[r+1])!=null?n:"",r+=2):a===":"?(e.push(t),t="",r++):(t+=a,r++)}return e.push(t),e}function me(...s){return s.length>0&&!s[0].startsWith("--")&&(s[0]=`--${s[0]}`),s.map(e=>e.replace(/\\/g,"\\\\").replace(/:/g,"\\:")).join(":")}function Ct(s,e,t,r){let n=new window.CommandEvent("command",{command:e,source:s,cancelable:!0,bubbles:!0,composed:!0});r&&(n.triggeringEvent=r),t.dispatchEvent(n)}var A=!1,Te=(r=>(r.WARNING="warning",r.ERROR="error",r.CRITICAL="critical",r))(Te||{});function l(s,e="error",t={}){let r=new Error(s);return r.severity=e,r.element=t.element,r.command=t.command,r.context=t.context,r.recovery=t.recovery,t.cause&&(r.cause=t.cause),r}function R(s,e="Invokers"){let t="severity"in s,r=t?s.severity:"error",n=r==="critical"||r==="error"?"error":"warn";if(A||r==="critical"){if(console.group(`${e}: ${s.message}`),console[n]("Error:",s),t){let a=s;a.element&&console.log("Element:",a.element),a.command&&console.log("Command:",a.command),a.context&&console.log("Context:",a.context),a.recovery&&console.log("Suggested fix:",a.recovery)}console.groupEnd()}else console[n](`${e}: ${s.message}`,t?s.element:void 0)}function M(s,e){let t=[];if(!s)return t.push("Element not found"),t;if(e.id&&!s.id&&t.push("Element missing required id attribute"),e.tagName&&!e.tagName.includes(s.tagName.toLowerCase())&&t.push(`Element must be one of: ${e.tagName.join(", ")}, got: ${s.tagName.toLowerCase()}`),e.attributes)for(let r of e.attributes)s.hasAttribute(r)||t.push(`Element missing required attribute: ${r}`);return t}function ze(s){return s.map(e=>{if(typeof e!="string")return String(e);let t=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/data:text\/html/gi,"").replace(/vbscript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/expression\s*\(/gi,"");if(e.includes("://")||e.startsWith("//"))try{let r=new URL(e,window.location.href);if(!["http:","https:","ftp:","mailto:"].includes(r.protocol))return console.warn(`Invokers: Potentially unsafe URL protocol "${r.protocol}" detected and removed`),""}catch(r){return console.warn("Invokers: Malformed URL detected and removed:",e),""}return t})}function N(){return ee._interpolationEnabled}function le(s){if(!s||typeof s!="string")return"";let e=document.createElement("div");return e.innerHTML=s,e.querySelectorAll('script, object, embed, iframe, frame, meta, link[rel="import"]').forEach(n=>n.remove()),e.querySelectorAll("*").forEach(n=>{Array.from(n.attributes).forEach(a=>{(a.name.startsWith("on")||a.value.includes("javascript:")||a.value.includes("vbscript:")||a.value.includes("data:text/html"))&&n.removeAttribute(a.name)})}),e.innerHTML}var Se=class{constructor(e=1e3,t=50){this.executions=new Map;this.windowMs=e,this.maxExecutions=t}checkLimit(e){let t=Date.now(),n=(this.executions.get(e)||[]).filter(a=>t-a<this.windowMs);return n.length>=this.maxExecutions?!1:(n.push(t),this.executions.set(e,n),!0)}reset(e){e?this.executions.delete(e):this.executions.clear()}},Le=(i=>(i.BEFORE_COMMAND="beforeCommand",i.AFTER_COMMAND="afterCommand",i.BEFORE_VALIDATION="beforeValidation",i.AFTER_VALIDATION="afterValidation",i.ON_SUCCESS="onSuccess",i.ON_ERROR="onError",i.ON_COMPLETE="onComplete",i))(Le||{}),Ae=new Set(["show-modal","close","request-close","show-popover","hide-popover","toggle-popover"]),ue=class{constructor(){this.executionTimes=[];this.monitoringWindow=1e3}recordExecution(){let e=Date.now();return this.executionTimes=this.executionTimes.filter(t=>e-t<this.monitoringWindow),this.executionTimes.push(e),!0}getStats(){let e=Date.now(),t=this.executionTimes.filter(a=>e-a<this.monitoringWindow),r=t.slice(1).map((a,o)=>a-t[o]),n=r.length>0?r.reduce((a,o)=>a+o,0)/r.length:0;return{executionsLastSecond:t.length,averageInterval:n}}},L=class L{constructor(){this.commands=new Map;this.sortedCommandKeys=[];this.commandStates=new Map;this.performanceMonitor=new ue;this.plugins=new Map;this.middleware=new Map;this.andThenManager=new he(this),this.pipelineManager=new pe(this),typeof window!="undefined"&&typeof document!="undefined"?(this.registerCoreLibraryCommands(),this.registerExtendedCommands(),window.__invokerListenersAdded||(this.listen(),window.__invokerListenersAdded=!0),window.Invoker||(window.Invoker={register:this.register.bind(this),executeCommand:this.executeCommand.bind(this),registerPlugin:this.registerPlugin.bind(this),unregisterPlugin:this.unregisterPlugin.bind(this),registerMiddleware:this.registerMiddleware.bind(this),hasPlugin:this.hasPlugin.bind(this),getRegisteredPlugins:this.getRegisteredPlugins.bind(this),parseCommandString:Q,createCommandString:me,instance:this,HookPoint:Le,reset:this.reset.bind(this)})):typeof global!="undefined"&&global.window&&global.document&&(this.registerCoreLibraryCommands(),this.registerExtendedCommands(),global.__invokerListenersAdded||(this.listen(),global.__invokerListenersAdded=!0))}static getInstance(){return L._instance||(L._instance=new L),L._instance}_enableInterpolation(){L._interpolationEnabled=!0}reset(){L._interpolationEnabled=!1,typeof window!="undefined"&&window.Invoker&&(window.Invoker.interpolateString=void 0,window.Invoker.generateUid=void 0,window.Invoker.getInterpolationUtility=void 0),console.log("Invokers: Reset complete.")}_tryInterpolate(e,t){var r;return L._interpolationEnabled&&typeof window!="undefined"&&((r=window.Invoker)!=null&&r.getInterpolationUtility)?window.Invoker.getInterpolationUtility()(e,t):e}async executeCommand(e,t,r){if(!this.performanceMonitor.recordExecution())return;if(!e||typeof e!="string"){let o=l("Command must be a non-empty string","error",{command:e,recovery:'Provide a valid command string like "--toggle" or "show-modal"'});R(o);return}if(!t||typeof t!="string"){let o=l("Target ID must be a non-empty string","error",{command:e,context:{targetId:t},recovery:"Provide a valid element ID that exists in the DOM"});R(o);return}let n=k(t,r||document.body);if(n.length===0){let o=Array.from(document.querySelectorAll("[id]")).map(d=>d.id).filter(Boolean),i=o.filter(d=>d.includes(t.toLowerCase())||t.includes(d.toLowerCase())),c=l(`Target element with selector "${t}" not found`,"error",{command:e,element:r,context:{targetId:t,availableIds:o.slice(0,10),suggestions:i.slice(0,3)},recovery:i.length>0?`Did you mean: ${i.slice(0,3).join(", ")}?`:"Check that the target element exists and has the correct selector"});R(c);return}let a=n[0];try{let o={command:e,source:r||null,target:a,preventDefault:()=>{},type:"command"};await this.executeCustomCommand(e,o)}catch(o){let i=l(`Failed to execute command "${e}" on element "${t}"`,"error",{command:e,element:r||a,cause:o,recovery:"Check the command syntax and ensure the target element supports this operation"});R(i)}}registerExtendedCommands(){for(let e in Z)Object.prototype.hasOwnProperty.call(Z,e)&&this.register(e,Z[e])}registerPlugin(e){if(this.plugins.has(e.name)){console.warn(`Invokers: Plugin "${e.name}" is already registered`);return}if(this.plugins.set(e.name,e),e.middleware)for(let[t,r]of Object.entries(e.middleware))r&&this.registerMiddleware(t,r);if(e.onRegister)try{e.onRegister(this)}catch(t){console.error(`Invokers: Error in plugin "${e.name}" onRegister:`,t)}A&&console.log(`Invokers: Plugin "${e.name}" registered successfully`)}unregisterPlugin(e){let t=this.plugins.get(e);if(!t){console.warn(`Invokers: Plugin "${e}" is not registered`);return}if(t.onUnregister)try{t.onUnregister(this)}catch(r){console.error(`Invokers: Error in plugin "${e}" onUnregister:`,r)}if(t.middleware)for(let r of Object.keys(t.middleware))this.unregisterMiddleware(r,t.middleware[r]);this.plugins.delete(e),A&&console.log(`Invokers: Plugin "${e}" unregistered successfully`)}registerMiddleware(e,t){this.middleware.has(e)||this.middleware.set(e,[]),this.middleware.get(e).push(t)}unregisterMiddleware(e,t){let r=this.middleware.get(e);if(r){let n=r.indexOf(t);n>-1&&r.splice(n,1)}}hasPlugin(e){return this.plugins.has(e)}getRegisteredPlugins(){return Array.from(this.plugins.keys())}async executeMiddleware(e,t,r=!1){let n=this.middleware.get(e);if(!(!n||n.length===0))for(let a of n)try{await Promise.resolve(a(t,e))}catch(o){if(r)throw o;console.error(`Invokers: Middleware error at ${e}:`,o)}}register(e,t){if(!e||typeof e!="string"){let a=l("Command name must be a non-empty string","error",{context:{name:e},recovery:'Provide a valid command name like "--my-command"'});R(a);return}if(!t||typeof t!="function"){let a=l(`Command callback for "${e}" must be a function`,"error",{command:e,context:{callback:t},recovery:"Provide a function that accepts a CommandContext parameter"});R(a);return}let r=e.trim();if(r.length===0){let a=l("Command name cannot be empty or whitespace only","error",{recovery:'Provide a meaningful command name like "--toggle" or "--fetch"'});R(a);return}let n=r;if(n.startsWith("--")||(n=`--${n}`,A&&console.warn(`Invokers: Command "${r}" registered without '--' prefix. Automatically registered as "${n}".`)),Ae.has(n.slice(2))){let a=l(`Cannot register custom command "${n}" - conflicts with native command "${n.slice(2)}"`,"error",{command:n,recovery:"Choose a different command name that doesn't conflict with native commands"});R(a);return}if(this.commands.has(n)){let a=l(`Command "${n}" is already registered and will be overwritten`,"warning",{command:n,recovery:"Use a different command name or ensure this overwrite is intentional"});R(a)}try{this.commands.set(n,t),this.sortedCommandKeys=Array.from(this.commands.keys()).sort((a,o)=>o.length-a.length),A&&console.log(`Invokers: Successfully registered command "${n}"`)}catch(a){let o=l(`Failed to register command "${n}"`,"critical",{command:n,cause:a,recovery:"Check that the callback function is valid and the command name is unique"});R(o)}}async handleCommand(e){let t=e.command;t.startsWith("--")?await this.executeCustomCommand(t,e):!Ae.has(t)&&t!==""&&(console.warn(`Invokers (Compatibility): Non-spec-compliant command "${t}" detected. Please update your HTML to use '--${t}' for future compatibility. Attempting to handle...`),await this.executeCustomCommand(`--${t}`,e))}async executeCustomCommand(e,t){var n,a;if(!e||typeof e!="string"){let o=l("Invalid command string provided","error",{command:e,element:t.source,recovery:"Ensure the command attribute contains a valid command string"});R(o);return}if(!this.performanceMonitor.recordExecution())return;let r=!1;for(let o of this.sortedCommandKeys)if(e.startsWith(o)&&(e.length===o.length||e[o.length]===":")){r=!0;let i=this.commands.get(o);if(!i){let c=l(`Command "${o}" is registered but callback is missing`,"critical",{command:e,element:t.source,recovery:"This is an internal error. Please report this issue."});R(c);return}try{t.preventDefault();let c={event:t.triggeringEvent,this:t.source,target:t.target,detail:(n=t.triggeringEvent)==null?void 0:n.detail},d=this._tryInterpolate(e,c),m=Q(d.substring(o.length+1)),f=ze(m),u=this.createContext(t,d,f),h=t.source,w=u.getTargets();if(w.length===0){let y=l("No target elements found for command execution","warning",{command:e,element:h,recovery:"Ensure commandfor, aria-controls, or data-target points to valid elements"});R(y);return}for(let y of w){let p={...u,targetElement:y};await this.executeMiddleware("beforeCommand",p,!0),await this.executeMiddleware("beforeValidation",p,!0);let C=`${e}:${y.id}`,x=this.commandStates.get(C)||"active";if(h){let T=h.dataset.state||h.getAttribute("data-state");T&&(this.commandStates.has(C)&&this.commandStates.get(C)==="completed"||(x=T))}if(x==="disabled"||x==="completed")continue;let E={success:!0};try{let T=this.validateContext(p);if(T.length>0)throw l(`Command execution aborted: ${T.join(", ")}`,"error",{command:e,element:p.invoker||p.targetElement,context:{validationErrors:T},recovery:"Fix the validation errors and try again"});await this.executeMiddleware("afterValidation",p);let I=Promise.resolve(i(p)),b=new Promise((g,S)=>{setTimeout(()=>S(new Error("Command execution timeout")),3e4)});await Promise.race([I,b]),x==="once"&&this.commandStates.set(C,"completed"),await this.executeMiddleware("onSuccess",{...p,result:E}),A&&console.log(`Invokers: Command "${o}" executed successfully on target ${y.id||y}`)}catch(T){E={success:!1,error:T},await this.executeMiddleware("onError",{...p,result:E});let I=l(`Command "${o}" execution failed`,"error",{command:e,element:p.invoker||p.targetElement,cause:T,context:{params:p.params,targetId:(a=p.targetElement)==null?void 0:a.id,invokerState:x},recovery:this.generateRecoverySuggestion(o,T,p)});R(I),this.attemptGracefulDegradation(p,T)}await this.executeMiddleware("onComplete",{...p,result:E}),await this.executeMiddleware("afterCommand",{...p,result:E}),u.invoker&&y===w[0]&&(await this.andThenManager.processAndThen(u.invoker,E,y),await this.triggerFollowup(u.invoker,y,E))}}catch(c){if(c.message.includes("Validation failed")||c.message.includes("Plugin attempted to access"))throw c;let d=l(`Failed to execute command "${o}"`,"critical",{command:e,element:t.source,cause:c,recovery:"Check command syntax and ensure all required attributes are present"});R(d)}return}if(!r){let o=this.findSimilarCommands(e),i=l(`Unknown command "${e}"`,"error",{command:e,element:t.source,context:{availableCommands:this.sortedCommandKeys.slice(0,10),suggestions:o},recovery:o.length>0?`Did you mean: ${o.join(", ")}?`:`Check the command name and ensure it's registered. Custom commands must start with "--"`});R(i)}}validateContext(e){let t=[];return e.targetElement?e.targetElement.isConnected||t.push("Target element is not connected to the DOM"):t.push("Target element is null or undefined"),e.params.some(r=>r==null)&&t.push("Command contains null or undefined parameters"),t}generateRecoverySuggestion(e,t,r){let n=t.message.toLowerCase();return e.includes("fetch")?n.includes("network")||n.includes("fetch")?"Check your network connection and ensure the URL is correct and reachable":n.includes("cors")?"CORS error: Ensure your server allows cross-origin requests or use a proxy":"Verify the data-url attribute points to a valid endpoint that returns HTML":e.includes("media")?"Ensure the target element is a <video> or <audio> element":e.includes("form")?"Ensure the target element is a <form> element with a valid action attribute":e.includes("class")?"Check that the class name is valid and the target element exists":e.includes("attr")?"Verify the attribute name is valid and check data-attr-name/data-attr-value attributes":n.includes("null")||n.includes("undefined")?"Check that all required elements and attributes are present in the DOM":n.includes("permission")||n.includes("security")?"This operation requires user permission or HTTPS context":"Check the command syntax and ensure all required attributes are present"}attemptGracefulDegradation(e,t){try{e.invoker&&e.invoker.hasAttribute("aria-expanded")&&e.invoker.getAttribute("aria-expanded")===null&&e.invoker.setAttribute("aria-expanded","false"),e.invoker&&e.invoker.hasAttribute("disabled")&&setTimeout(()=>{e.invoker&&e.invoker.removeAttribute("disabled")},3e3),A&&console.log("Invokers: Attempted graceful degradation for failed command")}catch(r){console.warn("Invokers: Graceful degradation failed:",r)}}findSimilarCommands(e){let t=e.toLowerCase(),r=[];for(let n of this.sortedCommandKeys){let a=n.toLowerCase();if(t.includes(a.slice(2))){r.push(n);continue}this.levenshteinDistance(t,a)<=2&&r.push(n)}return r.slice(0,3)}levenshteinDistance(e,t){let r=Array(t.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let n=0;n<=e.length;n++)r[0][n]=n;for(let n=0;n<=t.length;n++)r[n][0]=n;for(let n=1;n<=t.length;n++)for(let a=1;a<=e.length;a++){let o=e[a-1]===t[n-1]?0:1;r[n][a]=Math.min(r[n][a-1]+1,r[n-1][a]+1,r[n-1][a-1]+o)}return r[t.length][e.length]}async triggerFollowup(e,t,r){let n=this.getFollowupCommands(e,r);if(n.length!==0)for(let{command:a,target:o,state:i}of n){if(!o&&!t.id){console.warn("Invokers: A chained command requires the target element to have an ID.",t);continue}let c=o||t.id;c&&await this.scheduleCommand(a,c,i,t)}}getFollowupCommands(e,t){var a,o,i,c;if(!e)return[];let r=[],n=e.dataset.andThen||e.dataset.thenCommand;if(n){let d={event:e.triggeringEvent,this:e,target:null,detail:(a=e.triggeringEvent)==null?void 0:a.detail},m=this._tryInterpolate(n,d);r.push({command:m,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})}if(t){if(t.success&&e.dataset.afterSuccess){let d={event:e.triggeringEvent,this:e,target:null,detail:(o=e.triggeringEvent)==null?void 0:o.detail};e.dataset.afterSuccess.split(",").forEach(m=>{let f=this._tryInterpolate(m.trim(),d);r.push({command:f,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})})}if(!t.success&&e.dataset.afterError){let d={event:e.triggeringEvent,this:e,target:null,detail:(i=e.triggeringEvent)==null?void 0:i.detail};e.dataset.afterError.split(",").forEach(m=>{let f=this._tryInterpolate(m.trim(),d);r.push({command:f,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})})}if(e.dataset.afterComplete){let d={event:e.triggeringEvent,this:e,target:null,detail:(c=e.triggeringEvent)==null?void 0:c.detail};e.dataset.afterComplete.split(",").forEach(m=>{let f=this._tryInterpolate(m.trim(),d);r.push({command:f,target:e.dataset.thenTarget||e.dataset.target,state:e.dataset.state||"active"})})}}return r}createContext(e,t,r){let n=e.source,a=e.target,o=()=>{var y;if(!n){let p=i();return p?[p]:[]}let u=n.getAttribute("commandfor");if(u)return k(u,n);let h=(y=n.getAttribute("aria-controls"))==null?void 0:y.trim();if(h)return u="#"+h.split(/\s+/).join(", #"),k(u,n);let w=n.dataset.target;return w?k(w,n):a?[a]:[]},i=()=>a&&a.id?document.getElementById(a.id):a,c=u=>{if(!n)return;let h=u.some(w=>!w.hidden);n.setAttribute("aria-expanded",String(h)),n.hasAttribute("aria-pressed")&&n.setAttribute("aria-pressed",String(h))},d=()=>{if(!n)return;let u=o();if(u.length===0||!u[0].parentElement)return;let h=u[0].parentElement,w=new Set(Array.from(h.children).map(p=>p.id).filter(Boolean));Array.from(document.querySelectorAll("[commandfor], [aria-controls]")).filter(p=>{var x,E;return(p.getAttribute("commandfor")?[p.getAttribute("commandfor")]:[]).concat((E=(x=p.getAttribute("aria-controls"))==null?void 0:x.split(/\s+/))!=null?E:[]).some(T=>w.has(T))}).forEach(p=>{p!==n&&(p.setAttribute("aria-expanded","false"),p.hasAttribute("aria-pressed")&&p.setAttribute("aria-pressed","false"))})},m=(u,h,w="active")=>{n&&this.scheduleCommand(u,h||a.id,w,a)},f=u=>{n&&(u.onSuccess&&u.onSuccess.length>0&&(n.dataset.afterSuccess=u.onSuccess.join(",")),u.onError&&u.onError.length>0&&(n.dataset.afterError=u.onError.join(",")),u.onComplete&&u.onComplete.length>0&&(n.dataset.afterComplete=u.onComplete.join(",")))};return{invoker:n,targetElement:n?a:i()||a,fullCommand:t,params:r,triggeringEvent:e.triggeringEvent,getTargets:o,updateAriaState:c,manageGroupState:d,executeAfter:m,executeConditional:f}}listen(){document.addEventListener("command",e=>this.handleCommand(e),!0)}async scheduleCommand(e,t,r,n){let a=`${e}:${t}`;if(this.commandStates.get(a)==="disabled"||this.commandStates.get(a)==="completed")return;let o=document.getElementById(t)||(n&&t===n.id?n:null);if(o){let i={command:e,source:null,target:o,preventDefault:()=>{},type:"command"};await this.executeCustomCommand(e,i)}r==="once"?this.commandStates.set(a,"completed"):r==="completed"&&this.commandStates.set(a,"completed")}registerCoreLibraryCommands(){this.register("--toggle",async({getTargets:e,updateAriaState:t,invoker:r})=>{let n=e();if(n.length===0){let a=l("No target elements found for --toggle command","warning",{command:"--toggle",element:r,recovery:"Ensure commandfor points to a valid element id, or use aria-controls for multiple targets"});R(a);return}try{let a=()=>{n.forEach(o=>{if(!o.isConnected){console.warn("Invokers: Skipping disconnected target element",o);return}o.toggleAttribute("hidden")}),t(n)};await(document.startViewTransition?document.startViewTransition(a).finished:Promise.resolve(a()))}catch(a){throw l("Failed to toggle element visibility","error",{command:"--toggle",element:r,cause:a,recovery:"Check that target elements are valid DOM elements"})}}),this.register("--show",async({getTargets:e,updateAriaState:t,manageGroupState:r,invoker:n})=>{let a=e();if(a.length===0){let o=l("No target elements found for --show command","warning",{command:"--show",element:n,recovery:"Ensure commandfor points to a valid element id"});R(o);return}if(!a[0].parentElement){let o=l("Target element has no parent for --show command (cannot hide siblings)","warning",{command:"--show",element:a[0],recovery:"Use --toggle instead, or ensure the target element has siblings to manage"});R(o);return}try{let o=Array.from(a[0].parentElement.children),i=()=>{r(),o.forEach(c=>{c instanceof HTMLElement&&c.setAttribute("hidden","")}),a.forEach(c=>c.removeAttribute("hidden")),t(a)};await(document.startViewTransition?document.startViewTransition(i).finished:Promise.resolve(i()))}catch(o){throw l("Failed to show element and hide siblings","error",{command:"--show",element:n,cause:o,recovery:"Check that target elements and their siblings are valid DOM elements"})}}),this.register("--hide",({getTargets:e,updateAriaState:t})=>{let r=e();r.length!==0&&(r.forEach(n=>n.setAttribute("hidden","")),t(r))}),this.register("--class",({invoker:e,getTargets:t,params:r})=>{let[n,...a]=r,o=t();if(!n||o.length===0){console.warn('Invokers: `--class` command requires an action (e.g., "--class:toggle:my-class").',e);return}o.forEach(i=>{if(n==="ternary"){let[c,d,m]=a;if(!c||!d||!m){console.warn("Invokers: `--class:ternary` requires class-if-true, class-if-false, and condition.",e);return}let f=!1;m==="has-content"?f=!!(i.textContent&&i.textContent.trim()):m==="has-no-content"&&(f=!(i.textContent&&i.textContent.trim())),f?(i.classList.add(c),i.classList.remove(d)):(i.classList.remove(c),i.classList.add(d))}else if(n==="toggle"&&a[1]){let[c,d]=a;d==="has-content"?i.textContent&&i.textContent.trim()!==""?i.classList.add(c):i.classList.remove(c):d==="has-no-content"?i.textContent&&i.textContent.trim()!==""?i.classList.remove(c):i.classList.add(c):i.classList.toggle(c)}else{let c=a[0];if(!c&&n!=="clear"){console.warn("Invokers: `--class` command requires a class name.",e);return}switch(n){case"add":i.classList.add(c);break;case"remove":i.classList.remove(c);break;case"toggle":i.classList.toggle(c);break;case"clear":i.className="";break;default:console.warn(`Invokers: Unknown action "${n}" for '--class' command.`,e)}}})}),this.register("--text",({invoker:e,getTargets:t,params:r})=>{let[n,...a]=r,o=a.join(" "),i=t();if(!n)throw l("Text command requires an action (set, append, prepend, or clear)","error",{command:"--text",element:e,context:{params:r},recovery:"Use format: --text:set:Hello World or --text:append: more text"});if(i.length===0){let d=l("No target elements found for --text command","warning",{command:"--text",element:e,recovery:"Ensure commandfor points to a valid element id"});R(d);return}let c=["set","append","prepend","clear"];if(!c.includes(n))throw l(`Invalid text action "${n}". Must be one of: ${c.join(", ")}`,"error",{command:"--text",element:e,context:{action:n,validActions:c},recovery:"Use a valid action like: --text:set:Hello or --text:append: World"});try{i.forEach(d=>{if(!d.isConnected){console.warn("Invokers: Skipping disconnected target element",d);return}switch(n){case"set":d.textContent=o||"";break;case"append":d.textContent+=o||"";break;case"prepend":d.textContent=(o||"")+d.textContent;break;case"clear":d.textContent="";break}})}catch(d){throw l(`Failed to update text content with action "${n}"`,"error",{command:"--text",element:e,cause:d,context:{action:n,value:o},recovery:"Check that target elements support text content updates"})}}),this.register("--attr",({invoker:e,getTargets:t,params:r})=>{let[n,a,o]=r,i=t();if(!n)throw l("Attribute command requires an action (set, remove, or toggle)","error",{command:"--attr",element:e,context:{params:r},recovery:"Use format: --attr:set:disabled:true or --attr:remove:disabled"});if(!a)throw l("Attribute command requires an attribute name","error",{command:"--attr",element:e,context:{action:n,params:r},recovery:"Specify the attribute name: --attr:set:data-value:123"});if(i.length===0){let m=l("No target elements found for --attr command","warning",{command:"--attr",element:e,recovery:"Ensure commandfor points to a valid element id"});R(m);return}let c=["set","remove","toggle"];if(!c.includes(n))throw l(`Invalid attribute action "${n}". Must be one of: ${c.join(", ")}`,"error",{command:"--attr",element:e,context:{action:n,validActions:c},recovery:"Use a valid action like: --attr:set:disabled:true or --attr:toggle:hidden"});if(!/^[a-zA-Z][a-zA-Z0-9-]*$/.test(a))throw l(`Invalid attribute name "${a}". Attribute names must start with a letter and contain only letters, numbers, and hyphens`,"error",{command:"--attr",element:e,context:{attrName:a},recovery:'Use a valid HTML attribute name like "disabled" or "data-value"'});let d=o;if(N()&&o){let m={this:{...e,dataset:{...e.dataset},value:e.value||""},data:document.body.dataset,event:e.triggeringEvent};d=H(o,m)}try{i.forEach(m=>{if(!m.isConnected){console.warn("Invokers: Skipping disconnected target element",m);return}switch(n){case"set":m.setAttribute(a,d||"");break;case"remove":m.removeAttribute(a);break;case"toggle":m.hasAttribute(a)?m.removeAttribute(a):m.setAttribute(a,d||"");break}})}catch(m){throw l(`Failed to update attribute "${a}" with action "${n}"`,"error",{command:"--attr",element:e,cause:m,context:{action:n,attrName:a,attrValue:o},recovery:"Check that the attribute operation is valid for the target elements"})}}),this.register("--value",({invoker:e,getTargets:t,params:r})=>{let[n,...a]=r,o=t();if(o.length===0){let i=l("No target elements found for --value command","warning",{command:"--value",element:e,recovery:"Ensure commandfor points to a valid form input element"});R(i);return}try{o.forEach(i=>{if("value"in i){let c="";n==="clear"?c="":n==="set"&&a.length>0?c=a.join(":"):c=n||"",i.value=c}else console.warn("Invokers: --value command target does not support value property",i)})}catch(i){throw l("Failed to set value on target elements","error",{command:"--value",element:e,cause:i,recovery:"Ensure target elements are form inputs that support the value property"})}}),this.register("--focus",({invoker:e,getTargets:t})=>{let r=t();if(r.length===0){let n=l("No target elements found for --focus command","warning",{command:"--focus",element:e,recovery:"Ensure commandfor points to a focusable element"});R(n);return}try{typeof r[0].focus=="function"?r[0].focus():console.warn("Invokers: Target element does not support focus",r[0])}catch(n){throw l("Failed to focus target element","error",{command:"--focus",element:e,cause:n,recovery:"Ensure the target element is focusable and visible"})}}),this.register("--disabled",({invoker:e,getTargets:t,params:r})=>{let[n]=r,a=t();if(a.length===0){let o=l("No target elements found for --disabled command","warning",{command:"--disabled",element:e,recovery:"Ensure commandfor points to an element that supports the disabled property"});R(o);return}try{a.forEach(o=>{if("disabled"in o){let i=o;switch(n){case"toggle":i.disabled=!i.disabled;break;case"true":case"enable":i.disabled=!1;break;case"false":case"disable":i.disabled=!0;break;default:console.warn(`Invokers: Unknown action "${n}" for --disabled command. Use "toggle", "true", "false", "enable", or "disable".`)}}else console.warn("Invokers: --disabled command target does not support disabled property",o)})}catch(o){throw l("Failed to update disabled state on target elements","error",{command:"--disabled",element:e,cause:o,recovery:"Ensure target elements support the disabled property"})}}),this.register("--scroll",({invoker:e,getTargets:t,params:r})=>{let[n]=r,a=t();if(a.length===0){let o=l("No target elements found for --scroll command","warning",{command:"--scroll",element:e,recovery:"Ensure commandfor points to a valid element"});R(o);return}try{a.forEach(o=>{switch(n){case"into-view":o.scrollIntoView({behavior:"smooth",block:"start"});break;case"top":o.scrollIntoView({behavior:"smooth",block:"start"});break;case"bottom":o.scrollIntoView({behavior:"smooth",block:"end"});break;case"center":o.scrollIntoView({behavior:"smooth",block:"center"});break;default:console.warn(`Invokers: Unknown action "${n}" for --scroll command. Use "into-view", "top", "bottom", or "center".`),o.scrollIntoView({behavior:"smooth"})}})}catch(o){throw l("Failed to scroll target elements into view","error",{command:"--scroll",element:e,cause:o,recovery:"Ensure target elements are valid DOM elements"})}}),this.register("--storage",({invoker:e,getTargets:t,params:r})=>{var m,f,u;let[n,a,o,...i]=r,c=t();if(!n||!["local","session"].includes(n))throw l(`Invalid storage type "${n}". Must be "local" or "session"`,"error",{command:"--storage",element:e,context:{storageType:n,availableTypes:["local","session"]},recovery:"Use --storage:local:action:key or --storage:session:action:key"});let d=n==="local"?localStorage:sessionStorage;if(typeof Storage=="undefined")throw l("Web Storage API not supported in this browser","error",{command:"--storage",element:e,recovery:"Use a modern browser that supports localStorage/sessionStorage"});try{switch(a){case"set":if(!o)throw l("Storage set requires a key","error",{command:"--storage",element:e,recovery:"Use --storage:local:set:key:value or --storage:session:set:key:value"});let h=i.join(":");!h&&c.length>0&&"value"in c[0]&&(h=c[0].value);let w=((m=e==null?void 0:e.dataset)==null?void 0:m.storageJson)==="true"||h.startsWith("{")||h.startsWith("[");if(w)try{JSON.parse(h)}catch(b){h=JSON.stringify(h)}let y=(f=e==null?void 0:e.dataset)==null?void 0:f.storageExpires;if(y){let b=Date.now()+parseInt(y,10)*1e3,g={value:h,expiresAt:b,isJson:w};d.setItem(o,JSON.stringify(g))}else d.setItem(o,h);break;case"get":if(!o)throw l("Storage get requires a key","error",{command:"--storage",element:e,recovery:"Use --storage:local:get:key or --storage:session:get:key"});let p=d.getItem(o),C=p;if(p!==null)try{let b=JSON.parse(p);b&&typeof b=="object"&&"value"in b&&"expiresAt"in b&&(Date.now()>b.expiresAt?(d.removeItem(o),C=null):C=b.isJson?JSON.stringify(b.value):b.value)}catch(b){}c.length>0&&C!==null&&("value"in c[0]?c[0].value=C:c[0].textContent=C);break;case"remove":if(!o)throw l("Storage remove requires a key","error",{command:"--storage",element:e,recovery:"Use --storage:local:remove:key or --storage:session:remove:key"});d.removeItem(o),c.length>0&&("value"in c[0]?c[0].value="":c[0].textContent="Stored username will appear here");break;case"clear":d.clear(),c.length>0&&(c[0].textContent="Storage cleared successfully");break;case"keys":let x=o||"",E=Object.keys(d).filter(b=>b.startsWith(x));c.length>0&&(c[0].textContent=JSON.stringify(E));break;case"has":let T=d.getItem(o)!==null;c.length>0&&(c[0].textContent=T.toString());break;case"size":let I=0;for(let b=0;b<d.length;b++){let g=d.key(b);g&&(I+=g.length+(((u=d.getItem(g))==null?void 0:u.length)||0))}c.length>0&&(c[0].textContent=I.toString());break;default:throw l(`Unknown storage action "${a}"`,"error",{command:"--storage",element:e,context:{action:a,availableActions:["set","get","remove","clear","keys","has","size"]},recovery:"Use set, get, remove, clear, keys, has, or size actions"})}}catch(h){throw h instanceof Error&&h.name==="QuotaExceededError"?l("Storage quota exceeded. Cannot store more data.","error",{command:"--storage",element:e,cause:h,recovery:"Clear some storage space or use sessionStorage instead of localStorage"}):l(`Storage operation failed: ${h.message}`,"error",{command:"--storage",element:e,cause:h,recovery:"Check storage availability, quota limits, and data format"})}}),this.register("--animate",({invoker:e,getTargets:t,params:r})=>{var u,h,w,y;let[n,...a]=r,o=t();if(o.length===0){let p=l("No target elements found for --animate command","warning",{command:"--animate",element:e,recovery:"Ensure commandfor points to a valid element"});R(p);return}let i=["fade-in","fade-out","slide-up","slide-down","slide-left","slide-right","bounce","shake","pulse","flip","rotate-in","zoom-in","zoom-out","spin","wobble","jello","heartbeat","rubber-band"];if(!i.includes(n))throw l(`Unknown animation "${n}"`,"error",{command:"--animate",element:e,context:{animation:n,validAnimations:i},recovery:`Use one of: ${i.join(", ")}`});let c="0.5s",d="0s",m="ease-in-out",f="1";a.forEach(p=>{p.includes("duration:")?c=p.split(":")[1]||"0.5s":p.includes("delay:")?d=p.split(":")[1]||"0s":p.includes("easing:")?m=p.split(":")[1]||"ease-in-out":p.includes("iterations:")&&(f=p.split(":")[1]||"1")}),(u=e==null?void 0:e.dataset)!=null&&u.animateDuration&&(c=e.dataset.animateDuration),(h=e==null?void 0:e.dataset)!=null&&h.animateDelay&&(d=e.dataset.animateDelay),(w=e==null?void 0:e.dataset)!=null&&w.animateEasing&&(m=e.dataset.animateEasing),(y=e==null?void 0:e.dataset)!=null&&y.animateIterations&&(f=e.dataset.animateIterations);try{o.forEach(p=>{if(!p.isConnected){console.warn("Invokers: Skipping disconnected target element",p);return}p.classList.forEach(T=>{T.startsWith("invokers-animate-")&&p.classList.remove(T)}),p.style.animation="",p.offsetHeight;let C=`invokers-${n}`,x=`${C} ${c} ${m} ${d} ${f}`;p.style.animation=x;let E=T=>{T.animationName===C&&(p.style.animation="",p.removeEventListener("animationend",E))};p.addEventListener("animationend",E),setTimeout(()=>{p.style.animation.includes(C)&&(p.style.animation="",p.removeEventListener("animationend",E))},parseFloat(c)*1e3+parseFloat(d)*1e3+100)})}catch(p){throw l("Failed to animate target elements","error",{command:"--animate",element:e,cause:p,recovery:"Ensure target elements support CSS animations and check animation parameters"})}}),this.register("--url",({invoker:e,getTargets:t,params:r})=>{var d,m,f,u;let[n,...a]=r,o=t(),i=window.location,c=window.history;try{switch(n){case"params-get":if(a.length===0)throw l("URL params-get requires a parameter name","error",{command:"--url",element:e,recovery:"Use --url:params-get:param-name"});let h=a[0],w=i.search.startsWith("?")?i.search.substring(1):i.search,p=new URLSearchParams(w).get(h)||"";o.length>0&&("value"in o[0]?o[0].value=p:o[0].textContent=p);break;case"params-set":let C,x;if(a.length>=2){let[Fe,...$e]=a;C=Fe,x=$e.join(":")}else if(a.length===1)if(C=a[0],o.length>0&&"value"in o[0])x=o[0].value;else throw l("URL params-set with single parameter requires a target input element with a value","error",{command:"--url",element:e,recovery:"Use --url:params-set:param-name and commandfor pointing to an input element, or provide value: --url:params-set:param-name:value"});else if(a.length===0){if(C=((d=e==null?void 0:e.dataset)==null?void 0:d.urlParamName)||((m=e==null?void 0:e.dataset)==null?void 0:m.paramName)||"",!C)throw l("URL params-set without parameters requires data-url-param-name attribute","error",{command:"--url",element:e,recovery:'Add data-url-param-name="param-name" or use --url:params-set:param-name:value'});if(o.length>0&&"value"in o[0])x=o[0].value;else throw l("URL params-set without value parameter requires a target input element","error",{command:"--url",element:e,recovery:"Use commandfor pointing to an input element with the parameter value"})}else throw l("URL params-set requires parameter name and value","error",{command:"--url",element:e,recovery:"Use --url:params-set:param-name:value, or --url:params-set:param-name with commandfor to input element"});let E=new URL(i.href);E.searchParams.set(C,x);let T=((f=e==null?void 0:e.dataset)==null?void 0:f.urlPreserveState)==="true";c.replaceState(T?c.state:null,"",E.toString());break;case"params-delete":if(a.length===0)throw l("URL params-delete requires a parameter name","error",{command:"--url",element:e,recovery:"Use --url:params-delete:param-name"});let I=a[0],b=new URL(i.href);b.searchParams.delete(I),c.replaceState(null,"",b.toString());break;case"params-clear":let g=new URL(i.href);g.search="",c.replaceState(null,"",g.toString());break;case"params-all":let S=i.search.startsWith("?")?i.search.substring(1):i.search,F=Object.fromEntries(new URLSearchParams(S)),Me=JSON.stringify(F);o.length>0&&(o[0].textContent=Me);break;case"hash-get":let fe=i.hash.substring(1);o.length>0&&("value"in o[0]?o[0].value=fe:o[0].textContent=fe);break;case"hash-set":let J;if(a.length>0)J=a.join(":");else if(o.length>0&&"value"in o[0])J=o[0].value;else throw l("URL hash-set without value requires a target input element with a value","error",{command:"--url",element:e,recovery:"Use --url:hash-set:hash-value or commandfor pointing to an input element"});i.hash=J?`#${J}`:"";break;case"hash-clear":i.hash="";break;case"pathname-get":let Oe=i.pathname;o.length>0&&(o[0].textContent=Oe);break;case"pathname-set":let te;if(a.length>0)te=a[0];else if(o.length>0&&"value"in o[0])te=o[0].value;else throw l("URL pathname-set without value requires a target input element with a value","error",{command:"--url",element:e,recovery:"Use --url:pathname-set:/new-path or commandfor pointing to an input element"});let ge=new URL(i.href);ge.pathname=te,c.replaceState(null,"",ge.toString());break;case"reload":let Ne=((u=e==null?void 0:e.dataset)==null?void 0:u.urlForceReload)==="true";i.reload(Ne);break;case"replace":if(a.length===0)throw l("URL replace requires a URL","error",{command:"--url",element:e,recovery:"Use --url:replace:new-url"});let Pe=a.join(":");c.replaceState(null,"",Pe);break;case"navigate":if(a.length===0)throw l("URL navigate requires a URL","error",{command:"--url",element:e,recovery:"Use --url:navigate:new-url"});let He=a.join(":");c.pushState({},"",He);break;case"base":let ke=`${i.protocol}//${i.host}`;o.length>0&&(o[0].textContent=ke);break;case"full":let De=i.href;o.length>0&&(o[0].textContent=De);break;default:throw l(`Unknown URL action "${n}"`,"error",{command:"--url",element:e,context:{action:n,availableActions:["params-get","params-set","params-delete","params-clear","params-all","hash-get","hash-set","hash-clear","pathname-get","pathname-set","reload","replace","navigate","base","full"]},recovery:"Use a valid URL action"})}}catch(h){throw l("URL operation failed","error",{command:"--url",element:e,cause:h,recovery:"Check URL format, parameter names, and browser support"})}}),this.register("--history",({invoker:e,getTargets:t,params:r})=>{let n=t(),a=r[0],o=r.slice(1);r[0]==="state"?r.length===1?(a="state:get",o=[]):(a=`${r[0]}:${r[1]}`,o=r.slice(2)):r.length>=2&&["length","clear"].includes(r[0])&&(a=`${r[0]}:${r[1]}`,o=r.slice(2));try{switch(a){case"push":if(o.length===0)throw l("History push requires a URL","error",{command:"--history",element:e,recovery:"Use --history:push:url or --history:push:url:title:state-data"});let i=o[0],c=o[1]||"",d=o.slice(2).join(":"),m=null;if(d)try{m=JSON.parse(d)}catch(I){m=d}window.history.pushState(m,c,i),n.length>0&&(n[0].textContent=`Pushed ${i} to history`);break;case"replace":if(o.length===0)throw l("History replace requires a URL","error",{command:"--history",element:e,recovery:"Use --history:replace:url or --history:replace:url:title:state-data"});let f=o[0],u=o[1]||"",h=o.slice(2).join(":"),w=null;if(h)try{w=JSON.parse(h)}catch(I){w=h}window.history.replaceState(w,u,f),n.length>0&&(n[0].textContent=`Replaced current URL with ${f}`);break;case"back":window.history.back(),n.length>0&&(n[0].textContent="Navigated back in history");break;case"forward":window.history.forward(),n.length>0&&(n[0].textContent="Navigated forward in history");break;case"go":let y=o[0]?parseInt(o[0],10):-1;if(isNaN(y))throw l("History go requires a valid number","error",{command:"--history",element:e,recovery:"Use --history:go:number (positive for forward, negative for back)"});window.history.go(y),n.length>0&&(n[0].textContent=`Navigated ${y>0?"forward":"back"} ${Math.abs(y)} page(s) in history`);break;case"state:get":let p=window.history.state,C=JSON.stringify(p);n.length>0&&(n[0].textContent=C);break;case"state:set":if(o.length===0)throw l("History state:set requires state data","error",{command:"--history",element:e,recovery:"Use --history:state:set:json-data"});let x=o.join(":"),E;try{E=JSON.parse(x)}catch(I){E=x}window.history.replaceState(E,document.title);break;case"length":let T=window.history.length;n.length>0&&(n[0].textContent=T.toString());break;case"clear":window.history.replaceState(null,document.title);break;default:throw l(`Unknown history action "${a}"`,"error",{command:"--history",element:e,context:{action:a,availableActions:["push","replace","back","forward","go","state","state:get","state:set","length","clear"]},recovery:"Use a valid history action"})}}catch(i){throw l("History operation failed","error",{command:"--history",element:e,cause:i,recovery:"Check browser history support and parameters"})}}),this.register("--device",async({invoker:e,getTargets:t,params:r})=>{var c,d,m,f,u,h;let[n,...a]=r,o=t(),i=async w=>{if("permissions"in navigator)try{return(await navigator.permissions.query({name:w})).state==="granted"}catch(y){return!1}return!0};try{switch(n){case"vibrate":if(a.length===0)throw l("Device vibrate requires a pattern","error",{command:"--device",element:e,recovery:"Use --device:vibrate:200 or --device:vibrate:100:200:100"});if(!("vibrate"in navigator)){console.warn("Invokers: Vibration API not supported");return}let w=a.map(g=>parseInt(g,10));navigator.vibrate(w.length===1?w[0]:w)||console.warn("Invokers: Vibration failed - may be blocked or not supported");break;case"share":if(!("share"in navigator)){console.warn("Invokers: Web Share API not supported");return}let p={};if(a.length>0)for(let g=0;g<a.length;g+=2){let S=a[g],F=a[g+1];S&&F!==void 0&&(S==="url"?p.url=F:S==="text"?p.text=F:S==="title"&&(p.title=F))}try{await navigator.share(p),document.dispatchEvent(new CustomEvent("device:share:success"))}catch(g){document.dispatchEvent(new CustomEvent("device:share:cancelled",{detail:g}))}break;case"geolocation:get":if(!("geolocation"in navigator))throw l("Geolocation API not supported","error",{command:"--device",element:e,recovery:"Geolocation requires HTTPS and user permission"});if(!await i("geolocation")){console.warn("Invokers: Geolocation permission not granted"),document.dispatchEvent(new CustomEvent("geolocation:denied"));return}let x={enableHighAccuracy:((c=e==null?void 0:e.dataset)==null?void 0:c.geoHighAccuracy)==="true",timeout:parseInt(((d=e==null?void 0:e.dataset)==null?void 0:d.geoTimeout)||"10000"),maximumAge:parseInt(((m=e==null?void 0:e.dataset)==null?void 0:m.geoMaxAge)||"0")};navigator.geolocation.getCurrentPosition(g=>{let S={latitude:g.coords.latitude,longitude:g.coords.longitude,accuracy:g.coords.accuracy,altitude:g.coords.altitude,altitudeAccuracy:g.coords.altitudeAccuracy,heading:g.coords.heading,speed:g.coords.speed,timestamp:g.timestamp};o.length>0&&(o[0].textContent=JSON.stringify(S)),document.dispatchEvent(new CustomEvent("device:geolocation:success",{detail:S}))},g=>{let S={code:g.code,message:g.message};document.dispatchEvent(new CustomEvent("device:geolocation:error",{detail:S}))},x);break;case"orientation:get":if(!window.DeviceOrientationEvent){console.warn("Invokers: Device Orientation API not supported");return}let E=((f=window.screen)==null?void 0:f.orientation)||window.orientation,T={angle:(E==null?void 0:E.angle)||0,type:(E==null?void 0:E.type)||"unknown"};o.length>0&&(o[0].textContent=JSON.stringify(T)),document.dispatchEvent(new CustomEvent("device:orientation:current",{detail:T}));break;case"motion:get":if(!window.DeviceMotionEvent){console.warn("Invokers: Device Motion API not supported");return}if(typeof DeviceMotionEvent.requestPermission=="function")try{if(await DeviceMotionEvent.requestPermission()!=="granted"){console.warn("Invokers: Device motion permission denied");return}}catch(g){console.warn("Invokers: Failed to request device motion permission");return}let I=!0;o.length>0&&(o[0].textContent=JSON.stringify({supported:I}));break;case"battery:get":if(!("getBattery"in navigator)){console.warn("Invokers: Battery API not supported");return}try{let g=await navigator.getBattery(),S={level:g.level,charging:g.charging,chargingTime:g.chargingTime,dischargingTime:g.dischargingTime};o.length>0&&(o[0].textContent=JSON.stringify(S)),document.dispatchEvent(new CustomEvent("device:battery:status",{detail:S}))}catch(g){console.warn("Invokers: Failed to get battery status",g)}break;case"clipboard:read":if(!((u=navigator.clipboard)!=null&&u.readText)){console.warn("Invokers: Clipboard read not supported");return}try{let g=await navigator.clipboard.readText();o.length>0&&("value"in o[0]?o[0].value=g:o[0].textContent=g),document.dispatchEvent(new CustomEvent("device:clipboard:read",{detail:g}))}catch(g){console.warn("Invokers: Clipboard read failed",g),document.dispatchEvent(new CustomEvent("device:clipboard:denied"))}break;case"clipboard:write":if(!((h=navigator.clipboard)!=null&&h.writeText)){console.warn("Invokers: Clipboard write not supported");return}let b=a.join(":");if(!b)throw l("Clipboard write requires text to copy","error",{command:"--device",element:e,recovery:"Use --device:clipboard:write:text-to-copy"});try{await navigator.clipboard.writeText(b),document.dispatchEvent(new CustomEvent("device:clipboard:written",{detail:b}))}catch(g){console.warn("Invokers: Clipboard write failed",g),document.dispatchEvent(new CustomEvent("device:clipboard:denied"))}break;case"wake-lock":if(!("wakeLock"in navigator)){console.warn("Invokers: Wake Lock API not supported");return}try{let g=await navigator.wakeLock.request("screen");window._invokersWakeLock=g,document.dispatchEvent(new CustomEvent("device:wake-lock:acquired"))}catch(g){console.warn("Invokers: Wake lock request failed",g),document.dispatchEvent(new CustomEvent("device:wake-lock:denied"))}break;case"wake-lock:release":window._invokersWakeLock&&(window._invokersWakeLock.release(),delete window._invokersWakeLock,document.dispatchEvent(new CustomEvent("device:wake-lock:released")));break;default:throw l(`Unknown device action "${n}"`,"error",{command:"--device",element:e,context:{action:n,availableActions:["vibrate","share","geolocation:get","orientation:get","motion:get","battery:get","clipboard:read","clipboard:write","wake-lock","wake-lock:release"]},recovery:"Use a supported device action"})}}catch(w){throw l("Device API operation failed","error",{command:"--device",element:e,cause:w,recovery:"Check device API support, permissions, and parameters"})}}),this.register("--a11y",({invoker:e,getTargets:t,params:r})=>{var c;let[n,...a]=r,o=a.join(":"),i=t();try{switch(n){case"announce":if(!o)throw l("A11y announce requires text to announce","error",{command:"--a11y",element:e,recovery:"Use --a11y:announce:Your announcement text"});let d=((c=e==null?void 0:e.dataset)==null?void 0:c.announcePriority)||"polite",m=document.getElementById(`invokers-a11y-announcer-${d}`);m||(m=document.createElement("div"),m.id=`invokers-a11y-announcer-${d}`,m.setAttribute("aria-live",d),m.setAttribute("aria-atomic","true"),m.style.position="absolute",m.style.left="-10000px",m.style.width="1px",m.style.height="1px",m.style.overflow="hidden",document.body.appendChild(m)),m.textContent="",setTimeout(()=>{m.textContent=o},100);break;case"focus":if(i.length===0)throw l("A11y focus requires target elements","error",{command:"--a11y",element:e,recovery:"Use commandfor to specify which element to focus"});let f=i[0];f.focus&&(f.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{f.focus(),document.dispatchEvent(new CustomEvent("a11y:focus:changed",{detail:{element:f,label:f.textContent||f.getAttribute("aria-label")}}))},300));break;case"skip-to":if(!o)throw l("A11y skip-to requires an element ID","error",{command:"--a11y",element:e,recovery:"Use --a11y:skip-to:element-id"});let u=document.getElementById(o);if(u)!u.hasAttribute("tabindex")&&!["button","input","select","textarea","a"].includes(u.tagName.toLowerCase())&&u.setAttribute("tabindex","-1"),u.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{u.focus()},300);else throw l(`Element with id "${o}" not found`,"error",{command:"--a11y",element:e,recovery:"Ensure the target element exists and has the correct ID"});break;case"focus-trap":if(!o||!["enable","disable"].includes(o))throw l('A11y focus-trap requires "enable" or "disable"',"error",{command:"--a11y",element:e,recovery:"Use --a11y:focus-trap:enable or --a11y:focus-trap:disable"});if(o==="enable"&&i.length>0){let y=i[0],p=()=>y.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'),x=p()[0],E=I=>{let b=p(),g=b[0],S=b[b.length-1];I.key==="Tab"&&(I.shiftKey?document.activeElement===g&&(S.focus(),I.preventDefault()):document.activeElement===S&&(g.focus(),I.preventDefault())),I.key==="Escape"&&document.dispatchEvent(new CustomEvent("a11y:focus-trap:escape",{detail:{container:y}}))},T=I=>{let b=I.target;if(!y.contains(b)){let g=p();g.length>0&&g[0].focus()}};y.addEventListener("keydown",E),document.addEventListener("focusin",T),y._a11yFocusTrap={tabHandler:E,focusHandler:T},x==null||x.focus(),document.dispatchEvent(new CustomEvent("a11y:focus-trap:enabled",{detail:{container:y}}))}else if(o==="disable"&&i.length>0){let y=i[0],p=y._a11yFocusTrap;p&&(y.removeEventListener("keydown",p.tabHandler),document.removeEventListener("focusin",p.focusHandler),delete y._a11yFocusTrap),document.dispatchEvent(new CustomEvent("a11y:focus-trap:disabled",{detail:{container:y}}))}break;case"aria:set":if(!o||!o.includes(":"))throw l("A11y aria:set requires attribute:value format","error",{command:"--a11y",element:e,recovery:"Use --a11y:aria:set:attribute:value"});let[h,w]=o.split(":",2);i.length>0&&i.forEach(y=>{y.setAttribute(`aria-${h}`,w)});break;case"aria:remove":if(!o)throw l("A11y aria:remove requires an attribute name","error",{command:"--a11y",element:e,recovery:"Use --a11y:aria:remove:attribute"});i.length>0&&i.forEach(y=>{y.removeAttribute(`aria-${o}`)});break;case"heading-level":if(!o||!["1","2","3","4","5","6"].includes(o))throw l("A11y heading-level requires a level 1-6","error",{command:"--a11y",element:e,recovery:"Use --a11y:heading-level:1-6"});i.length>0&&i.forEach(y=>{var p;if(y.tagName.match(/^H[1-6]$/)){let C=`H${o}`,x=document.createElement(C);Array.from(y.attributes).forEach(E=>{x.setAttribute(E.name,E.value)}),x.innerHTML=y.innerHTML,(p=y.parentNode)==null||p.replaceChild(x,y)}else y.setAttribute("aria-level",o)});break;default:throw l(`Unknown accessibility action "${n}"`,"error",{command:"--a11y",element:e,context:{action:n,availableActions:["announce","focus","skip-to","focus-trap","aria:set","aria:remove","heading-level"]},recovery:"Use a valid accessibility action"})}}catch(d){throw l("Accessibility operation failed","error",{command:"--a11y",element:e,cause:d,recovery:"Check accessibility requirements and target elements"})}}),this.register("--pipeline",async({invoker:e,params:t})=>{let[r,n]=t;if(r!=="execute")throw l(`Invalid pipeline action "${r}". Only "execute" is supported`,"error",{command:"--pipeline",element:e,context:{action:r,availableActions:["execute"]},recovery:"Use --pipeline:execute:your-pipeline-id"});if(!n)throw l("Pipeline command requires a pipeline ID","error",{command:"--pipeline",element:e,context:{params:t},recovery:"Use --pipeline:execute:your-pipeline-id"});let a=this.createContext({command:"--pipeline:execute",source:e,target:e},"--pipeline:execute",t);await this.pipelineManager.executePipeline(n,a)})}registerPlugin(e){if(this.plugins.has(e.name))throw l(`Plugin "${e.name}" is already registered`,"error",{recovery:"Unregister the plugin first or use a different name"});if(this.plugins.set(e.name,e),e.middleware)for(let[t,r]of Object.entries(e.middleware))r&&this.registerMiddleware(t,r);e.onRegister&&e.onRegister()}unregisterPlugin(e){let t=this.plugins.get(e);if(!t)throw l(`Plugin "${e}" is not registered`,"error",{recovery:"Check the plugin name and ensure it is registered"});if(t.onUnregister&&t.onUnregister(),t.middleware)for(let[r,n]of Object.entries(t.middleware))n&&this.unregisterMiddleware(r,n);this.plugins.delete(e)}registerMiddleware(e,t){this.middleware.has(e)||this.middleware.set(e,[]),this.middleware.get(e).push(t)}unregisterMiddleware(e,t){let r=this.middleware.get(e);if(r){let n=r.indexOf(t);n>-1&&r.splice(n,1)}}async executeMiddleware(e,t){let r=this.middleware.get(e);if(r)for(let n of r)try{await n(t)}catch(a){R(l(`Middleware execution failed for hook "${e}"`,"error",{cause:a,recovery:"Check the middleware implementation for errors"}))}}};L._interpolationEnabled=!1;var ee=L,pe=class{constructor(e){this.invokerManager=e}async executePipeline(e,t){let r=document.getElementById(e);if(!(r!=null&&r.hasAttribute("data-pipeline"))){console.warn(`Invokers: Pipeline template "${e}" not found or not marked with data-pipeline attribute`);return}try{let n=this.parsePipelineSteps(r),a={success:!0};for(let o of n)if(this.shouldExecuteStep(o,a)&&(o.delay&&o.delay>0&&await new Promise(i=>setTimeout(i,o.delay)),a=await this.executeStep(o,t),o.once&&this.removeStepFromTemplate(r,o),!a.success&&!this.hasErrorHandler(n,n.indexOf(o)))){console.warn(`Invokers: Pipeline "${e}" stopped due to failed step: ${o.command}`);break}}catch(n){console.error(`Invokers: Pipeline "${e}" execution failed:`,n)}}parsePipelineSteps(e){let t=[];return e.content.querySelectorAll("pipeline-step").forEach((a,o)=>{let i=a.getAttribute("command"),c=a.getAttribute("target");if(!i||!c){console.warn(`Invokers: Pipeline step ${o} missing required command or target attribute`);return}let d={command:i,target:c,condition:a.getAttribute("condition")||"always",once:a.hasAttribute("once"),delay:parseInt(a.getAttribute("delay")||"0",10)},m={};Array.from(a.attributes).forEach(f=>{f.name.startsWith("data-")&&(m[f.name]=f.value)}),Object.keys(m).length>0&&(d.data=m),t.push(d)}),t}shouldExecuteStep(e,t){switch(e.condition){case"success":return t.success===!0;case"error":return t.success===!1;case"always":default:return!0}}async executeStep(e,t){try{let r=document.createElement("button");return r.setAttribute("type","button"),r.setAttribute("command",e.command.startsWith("--")?e.command:`--${e.command}`),r.setAttribute("commandfor",e.target),e.data&&Object.entries(e.data).forEach(([n,a])=>{r.setAttribute(n,a)}),await this.invokerManager.executeCommand(e.command,e.target,r),{success:!0}}catch(r){return{success:!1,error:r}}}hasErrorHandler(e,t){return e.slice(t+1).some(r=>r.condition==="error")}removeStepFromTemplate(e,t){e.content.querySelectorAll("pipeline-step").forEach(a=>{a.getAttribute("command")===t.command&&a.getAttribute("target")===t.target&&a.remove()})}},he=class{constructor(e){this.invokerManager=e}async processAndThen(e,t,r){let n=Array.from(e.children).filter(a=>a.tagName.toLowerCase()==="and-then");for(let a of n)await this.executeAndThenRecursively(a,e,t,r)}async executeAndThenRecursively(e,t,r,n,a=0){if(a>25){R(l("Maximum <and-then> depth reached, stopping execution to prevent infinite loop.","critical",{element:e,recovery:"Check for circular or excessively deep <and-then> nesting."}));return}let o=e.dataset.state;if(o==="disabled"||o==="completed")return;let i=e.dataset.condition||"always";if(!this.shouldExecuteCondition(i,r))return;let c=e.getAttribute("command"),d=e.getAttribute("commandfor")||t.getAttribute("commandfor")||n.id,m=parseInt(e.dataset.delay||"0",10);if(!c||!d){R(l('<and-then> element is missing required "command" or "commandfor" attribute.',"warning",{element:e}));return}m>0&&await new Promise(h=>setTimeout(h,m));let f={success:!0};try{let h=this.createSyntheticInvoker(e,c,d);await this.invokerManager.executeCommand(c,d,h)}catch(h){f={success:!1,error:h}}e.hasAttribute("data-once")?e.remove():e.dataset.state="completed";let u=Array.from(e.children).filter(h=>h.tagName.toLowerCase()==="and-then");for(let h of u)await this.executeAndThenRecursively(h,t,f,n,a+1)}createSyntheticInvoker(e,t,r){let n=document.createElement("button");n.setAttribute("command",t.startsWith("--")?t:`--${t}`),n.setAttribute("commandfor",r);for(let a in e.dataset)n.dataset[a]=e.dataset[a];return n}shouldExecuteCondition(e,t){switch(e.toLowerCase()){case"success":return t.success===!0;case"error":return t.success===!1;case"always":return!0;default:return R(l(`Unknown condition for <and-then> element: "${e}"`,"warning")),!1}}},v=ee.getInstance(),Ke=()=>{let s=null;typeof globalThis!="undefined"&&globalThis.window&&(s=globalThis.window),!s&&typeof global!="undefined"&&global.window&&(s=global.window),!s&&typeof window!="undefined"&&(s=window),s&&(s.Invoker={register:v.register.bind(v),executeCommand:v.executeCommand.bind(v),registerAll:v.registerExtendedCommands.bind(v),parseCommandString:Q,createCommandString:me,instance:v,get debug(){return A},set debug(e){A=e,console.log(`Invokers: Debug mode ${e?"enabled":"disabled"}.`)},getStats:()=>v.performanceMonitor.getStats(),getRegisteredCommands:()=>Array.from(v.commands.keys()),validateElement:M,createError:l,logError:R,registerPlugin:v.registerPlugin.bind(v),unregisterPlugin:v.unregisterPlugin.bind(v),registerMiddleware:v.registerMiddleware.bind(v),unregisterMiddleware:v.unregisterMiddleware.bind(v),reset(){v.commands.clear(),v.commandStates.clear(),v.sortedCommandKeys=[],v.plugins.clear(),v.middleware.clear(),console.log("Invokers: Reset complete.")}}),typeof window!="undefined"&&!window.Invoker&&(window.Invoker=(s==null?void 0:s.Invoker)||{register:v.register.bind(v),executeCommand:v.executeCommand.bind(v),registerAll:v.registerExtendedCommands.bind(v),parseCommandString:Q,createCommandString:me,instance:v,get debug(){return A},set debug(e){A=e,console.log(`Invokers: Debug mode ${e?"enabled":"disabled"}.`)},getStats:()=>v.performanceMonitor.getStats(),getRegisteredCommands:()=>Array.from(v.commands.keys()),validateElement:M,createError:l,logError:R,registerPlugin:v.registerPlugin.bind(v),unregisterPlugin:v.unregisterPlugin.bind(v),registerMiddleware:v.registerMiddleware.bind(v),unregisterMiddleware:v.unregisterMiddleware.bind(v),reset(){v.commands.clear(),v.commandStates.clear(),v.sortedCommandKeys=[],v.plugins.clear(),v.middleware.clear(),console.log("Invokers: Reset complete.")}})};Ke();var It=v;export{Te as ErrorSeverity,Le as HookPoint,ee as InvokerManager,Se as RateLimiter,Ct as _dispatchCommandEvent,Ie as applyInterestInvokers,me as createCommandString,Ge as createInterestEvent,l as createInvokerError,It as default,A as isDebugMode,Ce as isInterestInvokersSupported,N as isInterpolationEnabled,R as logInvokerError,Q as parseCommandString,le as sanitizeHTML,ze as sanitizeParams,M as validateElement};
/**
 * @file polyfill.ts
 * @summary A high-fidelity polyfill for the W3C/WHATWG HTML Invoker Buttons proposal.
 * @license MIT (Assumed from project context)
 * @author Keith Cirkel, Luke Warlow (original authors of explainer/polyfill)
 * @description This code implements the proposed `command` and `commandfor` attributes for HTMLButtonElement
 *              and the `CommandEvent` interface, allowing declarative UI interactions in browsers
 *              that do not yet natively support these features.
 *              It includes handling for popovers and dialogs, and a mechanism for custom commands.
 */
/**
 * @file interest-invokers.ts
 * @summary Interest Invokers polyfill and TypeScript support for the Invokers library
 * @description
 * This module provides comprehensive support for Interest Invokers as specified in:
 * https://open-ui.org/components/interest-invokers.explainer/
 * 
 * Based on the official polyfill by Mason Freed with TypeScript adaptation
 * and integration with the existing Invokers library patterns.
 * 
 * @author Mason Freed (original polyfill), Patrick Glenn (TypeScript adaptation)
 * @license MIT / BSD (compatible with original polyfill license)
 */
/**
 * @file index.ts
 * @version 1.1.0
 * @summary A lightweight, zero-dependency polyfill and superset for the upcoming native HTML Invoker Commands API.
 * @license MIT
 * @author Patrick Glenn
 * @see https://github.com/doeixd/invokers
 * @description
 * This library provides a robust polyfill for the W3C/WHATWG `command` attribute proposal
 * and extends it with a powerful set of custom commands (prefixed with `--`).
 * It features universal command chaining via the `data-and-then` attribute, allowing you
 * to create complex, declarative workflows in pure HTML.
 */
