"use strict";var h=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var g=(o,e)=>{for(var t in e)h(o,t,{get:e[t],enumerable:!0})},T=(o,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of E(e))!I.call(o,n)&&n!==t&&h(o,n,{get:()=>e[n],enumerable:!(s=v(e,n))||s.enumerable});return o};var b=o=>T(h({},"__esModule",{value:!0}),o);var H={};g(H,{applyInterestInvokers:()=>y,createInterestEvent:()=>L,isInterestInvokersSupported:()=>f});module.exports=b(H);function f(){return typeof HTMLButtonElement!="undefined"&&"interestForElement"in HTMLButtonElement.prototype}var d=class d{constructor(){this.initialized=!1;this.attributeName="interestfor";this.interestEventName="interest";this.loseInterestEventName="loseinterest";this.interestDelayStartProp="--interest-delay-start";this.interestDelayEndProp="--interest-delay-end";this.interestDelayProp="--interest-delay";this.dataField="__interestForData";this.targetDataField="__interestForTargetData";this.invokersWithInterest=new Set;this.touchInProgress=!1;this.InterestState={NoInterest:"none",FullInterest:"full"};this.Source={Hover:"hover",DeHover:"dehover",Focus:"focus",Blur:"blur",Touch:"touch"}}static getInstance(){return d.instance||(d.instance=new d),d.instance}apply(){if(window.interestForPolyfillInstalled)return;window.interestForPolyfillInstalled=!0;let e=f();e&&!window.interestForUsePolyfillAlways||(e&&this.disableNativeSupport(),this.setupPolyfill(),this.initialized=!0,console.log(`Interest Invokers polyfill installed (native: ${e}).`))}disableNativeSupport(){let e=t=>{t.isTrusted&&(t.preventDefault(),t.stopImmediatePropagation())};document.body.addEventListener(this.interestEventName,e,{capture:!0}),document.body.addEventListener(this.loseInterestEventName,e,{capture:!0})}setupPolyfill(){this.registerCustomProperties(),this.addEventHandlers(),this.setupElementMixins()}registerCustomProperties(){let e=document.createElement("style");e.textContent=`
      @property ${this.interestDelayStartProp} {
        syntax: "normal | <time>";
        inherits: false;
        initial-value: normal;
      }
      @property ${this.interestDelayEndProp} {
        syntax: "normal | <time>";
        inherits: false;
        initial-value: normal;
      }
      @property ${this.interestDelayProp} {
        syntax: "[ normal | <time> ]{1,2}";
        inherits: false;
        initial-value: normal;
      }
    `,document.head.appendChild(e),document[this.dataField]={globalPropsStyle:e}}setupElementMixins(){this.applyInterestInvokerMixin(HTMLButtonElement),this.applyInterestInvokerMixin(HTMLAnchorElement),this.applyInterestInvokerMixin(HTMLAreaElement),typeof SVGAElement!="undefined"&&this.applyInterestInvokerMixin(SVGAElement)}applyInterestInvokerMixin(e){Object.defineProperty(e.prototype,"interestForElement",{enumerable:!0,configurable:!0,get(){let t=this.getAttribute("interestfor");return t?document.getElementById(t):null},set(t){if(t===null)this.removeAttribute("interestfor");else if(t&&typeof t=="object"&&"id"in t)this.setAttribute("interestfor",t.id||"");else throw new TypeError("interestForElement must be an element or null")}})}addEventHandlers(){document.body.addEventListener("mouseover",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Hover)),document.body.addEventListener("mouseout",e=>this.handleInterestHoverOrFocus(e.target,this.Source.DeHover)),document.body.addEventListener("focusin",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Focus)),document.body.addEventListener("focusout",e=>this.handleInterestHoverOrFocus(e.target,this.Source.Blur)),document.body.addEventListener("keydown",e=>{e.key==="Escape"&&this.invokersWithInterest.forEach(t=>{this.clearState(t)})}),this.setupTouchHandlers()}setupTouchHandlers(){document.body.addEventListener("touchstart",s=>{this.touchInProgress=!0;let n=s.target.closest("button[interestfor]");if(n){this.initializeDataField(n);let r=n[this.dataField];r.longPressTimer=setTimeout(()=>{this.gainOrLoseInterest(n,this.getInterestForTarget(n),this.InterestState.FullInterest),r.longPressTimer=null},500)}});let t=s=>{let n=s.target.closest("button[interestfor]");if(n){let r=n[this.dataField];r!=null&&r.longPressTimer&&(clearTimeout(r.longPressTimer),r.longPressTimer=null)}};document.body.addEventListener("touchend",s=>{t(s),this.touchInProgress=!1}),document.body.addEventListener("touchmove",t)}handleInterestHoverOrFocus(e,t){var i,a,l,c,u,p;if(this.touchInProgress||!e.isConnected)return;if(!this.getInterestForTarget(e)){this.handleUpstreamInterest(e,t);return}if(e instanceof HTMLButtonElement&&e.disabled)return;this.initializeDataField(e);let n=e[this.dataField],r=this.getInterestInvoker(e);t===this.Source.Hover||t===this.Source.Focus?((i=n.clearLostTask)==null||i.call(n),(l=(a=r==null?void 0:r[this.dataField])==null?void 0:a.clearLostTask)==null||l.call(a),this.scheduleInterestGainedTask(e,this.InterestState.FullInterest)):((c=n.clearGainedTask)==null||c.call(n),n.state!==this.InterestState.NoInterest&&this.scheduleInterestLostTask(e),r&&((p=(u=r[this.dataField])==null?void 0:u.clearGainedTask)==null||p.call(u),(t===this.Source.Blur||!e.matches(":hover"))&&this.scheduleInterestLostTask(r)))}handleUpstreamInterest(e,t){var n;let s=e.closest(".interest-target");if(s){let r=this.getInterestInvoker(s);if(r){let i=r[this.dataField];t===this.Source.Hover||t===this.Source.Focus?(n=i==null?void 0:i.clearLostTask)==null||n.call(i):(t===this.Source.Blur||!e.matches(":hover"))&&this.scheduleInterestLostTask(r)}}}gainOrLoseInterest(e,t,s){var n,r;if(!e||!t||!e.isConnected||this.getInterestForTarget(e)!==t||s===this.InterestState.NoInterest&&this.getInterestInvoker(t)!==e)return!1;if(s!==this.InterestState.NoInterest){let i=this.getInterestInvoker(t);if(i){if(i===e)return(r=(n=i[this.dataField])==null?void 0:n.clearLostTask)==null||r.call(n),!1;if(!this.gainOrLoseInterest(i,t,this.InterestState.NoInterest)||!e.isConnected||this.getInterestForTarget(e)!==t)return!1}return this.applyState(e,s)}return this.clearState(e),!0}applyState(e,t){let s=e[this.dataField],n=this.getInterestForTarget(e);if(!n)return!1;switch(t){case this.InterestState.FullInterest:if(s.state!==this.InterestState.NoInterest)throw new Error("Invalid state");let r=new CustomEvent(this.interestEventName,{bubbles:!0,cancelable:!0});Object.defineProperty(r,"source",{value:e,writable:!1}),n.dispatchEvent(r),e.dispatchEvent(new CustomEvent("interest:shown",{bubbles:!0,detail:{target:n,source:e}}));try{n.hasAttribute("popover")&&typeof n.showPopover=="function"&&(n.showPopover(),this.supportsAnchorPositioning()||requestAnimationFrame(()=>this.positionPopover(e,n)))}catch(i){}if(s.state=this.InterestState.FullInterest,n[this.targetDataField]||(n[this.targetDataField]={}),n[this.targetDataField].invoker=e,n.hasAttribute("popover")){let i=this.createPopoverToggleListener();n[this.targetDataField].toggleListener=i,n.addEventListener("toggle",i)}this.invokersWithInterest.add(e),e.classList.add("interest-source"),n.classList.add("interest-target"),this.isPlainHint(n)||e.setAttribute("aria-expanded","true"),this.setupAnchorPositioning(e,n,s);break;default:throw new Error("Invalid state")}return!0}clearState(e){let t=e[this.dataField];if(t&&(clearTimeout(t.gainedTimer),clearTimeout(t.lostTimer),t.state!==this.InterestState.NoInterest)){let s=this.getInterestForTarget(e);if(s){let n=new CustomEvent(this.loseInterestEventName,{bubbles:!0,cancelable:!0});Object.defineProperty(n,"source",{value:e,writable:!1}),s.dispatchEvent(n),e.dispatchEvent(new CustomEvent("interest:lost",{bubbles:!0,detail:{target:s,source:e}}));try{typeof s.hidePopover=="function"&&s.hidePopover()}catch(i){}let r=s[this.targetDataField];r!=null&&r.toggleListener&&s.removeEventListener("toggle",r.toggleListener),s[this.targetDataField]=null,this.invokersWithInterest.delete(e),e.classList.remove("interest-source"),s.classList.remove("interest-target"),this.isPlainHint(s)||e.setAttribute("aria-expanded","false"),this.cleanupAnchorPositioning(e,s,t)}t.state=this.InterestState.NoInterest}}supportsAnchorPositioning(){return"anchorName"in document.body.style}setupAnchorPositioning(e,t,s){let n=`--interest-anchor-${Math.random().toString(36).substring(2)}`;if(e.style.anchorName=n,t.style.positionAnchor=n,s.anchorName=n,this.supportsAnchorPositioning()){let r=`interest-anchored-${Math.random().toString(36).substring(2)}`,i=document.createElement("style");i.textContent=`
      .${r} {
        margin: 0;
        top: calc(anchor(${n} bottom) - 4px);
        left: anchor(${n});
        justify-self: center;
      }
    `,document.head.appendChild(i),t.classList.add(r),s.styleElement=i,s.className=r}}cleanupAnchorPositioning(e,t,s){s.anchorName&&(e.style.anchorName="",t.style.positionAnchor="",s.anchorName=null),s.styleElement&&(s.styleElement.remove(),s.styleElement=null),s.className&&(t.classList.remove(s.className),s.className=null),t.style.position="",t.style.top="",t.style.left="",t.style.zIndex=""}positionPopover(e,t){let s=e.getBoundingClientRect(),n=t.getBoundingClientRect(),r=window.innerWidth,i=window.innerHeight,a,l;l=s.left+s.width/2-n.width/2,a=s.bottom-4,a+n.height>i&&(a=s.top-n.height+4,a<0&&(a=s.bottom+8));let c=Math.max(8,Math.min(l,r-n.width-8)),u=Math.max(8,Math.min(a,i-n.height-8));t.style.position="fixed",t.style.top=`${u}px`,t.style.left=`${c}px`,t.style.zIndex="9999"}createPopoverToggleListener(){return e=>{let t=e.target;if(e.newState==="closed"){let n=t[this.targetDataField],r=n==null?void 0:n.invoker;r&&this.gainOrLoseInterest(r,t,this.InterestState.NoInterest)}}}scheduleInterestGainedTask(e,t){var r;let s=this.getDelaySeconds(e,this.interestDelayStartProp)*1e3;if(!isFinite(s)||s<0)return;let n=e[this.dataField];(r=n.clearGainedTask)==null||r.call(n),n.gainedTimer=setTimeout(()=>{this.gainOrLoseInterest(e,this.getInterestForTarget(e),t)},s)}scheduleInterestLostTask(e){var n;let t=this.getDelaySeconds(e,this.interestDelayEndProp)*1e3;if(!isFinite(t)||t<0)return;let s=e[this.dataField];(n=s.clearLostTask)==null||n.call(s),s.lostTimer=setTimeout(()=>{this.gainOrLoseInterest(e,this.getInterestForTarget(e),this.InterestState.NoInterest)},t)}getDelaySeconds(e,t){let s=getComputedStyle(e),n=s.getPropertyValue(t).trim();if(n.toLowerCase()!=="normal")return this.parseTimeValue(n);let r=s.getPropertyValue(this.interestDelayProp).trim();if(r&&r.toLowerCase()!=="normal"){let i=r.split(/\s+/).filter(a=>a.length>0);if(i.length>0){let a=i[0],l=i.length>1?i[1]:a,c=t===this.interestDelayStartProp?a:l;if(c.toLowerCase()!=="normal")return this.parseTimeValue(c)}}return t===this.interestDelayStartProp?.5:.25}parseTimeValue(e){let t=String(e).trim(),s=t.match(/^([\d.]+)s$/);if(s)return parseFloat(s[1]);let n=t.match(/^([\d.]+)ms$/);return n?parseFloat(n[1])/1e3:parseFloat(t)||0}initializeDataField(e){if(e[this.dataField])return;e[this.dataField]={state:this.InterestState.NoInterest,gainedTimer:null,lostTimer:null,longPressTimer:null,anchorName:null,clearGainedTask(){clearTimeout(this.gainedTimer)},clearLostTask(){clearTimeout(this.lostTimer)}};let t=this.getInterestForTarget(e);t&&this.setupAccessibility(e,t)}setupAccessibility(e,t){this.isPlainHint(t)?e.setAttribute("aria-describedby",t.id):(e.setAttribute("aria-details",t.id),e.setAttribute("aria-expanded","false"),t.hasAttribute("role")||t.setAttribute("role","tooltip"))}isPlainHint(e){var r,i;if(((r=e.getAttribute("popover"))==null?void 0:r.toLowerCase())!=="hint")return!1;let t=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(",");if(e.querySelector(t))return!1;let s=["h1","h2","h3","h4","h5","h6","ul","ol","li","table","nav","header","footer","main","aside","article","section","form","blockquote","details","summary","dialog"].join(",");if(e.querySelector(s))return!1;let n=e.querySelectorAll("[role]");for(let a of n){let l=(i=a.getAttribute("role"))==null?void 0:i.toLowerCase();if(l&&!["presentation","none","generic","image"].includes(l))return!1}return!0}getInterestForTarget(e){let t=e.getAttribute(this.attributeName);return t?document.getElementById(t):null}getInterestInvoker(e){var n;let t=e[this.targetDataField],s=(t==null?void 0:t.invoker)||null;return s&&((n=s[this.dataField])==null?void 0:n.state)!==this.InterestState.NoInterest?s:null}isInitialized(){return this.initialized}};d.instance=null;var m=d;function y(){let o=m.getInstance();document.readyState==="complete"?o.apply():window.addEventListener("load",()=>o.apply())}function L(o,e){let t=new CustomEvent(o,{bubbles:!1,cancelable:!1});return Object.defineProperty(t,"source",{value:e||null,writable:!1,enumerable:!0}),t;return t}y();
/**
 * @file interest-invokers.ts
 * @summary Interest Invokers polyfill and TypeScript support for the Invokers library
 * @description
 * This module provides comprehensive support for Interest Invokers as specified in:
 * https://open-ui.org/components/interest-invokers.explainer/
 * 
 * Based on the official polyfill by Mason Freed with TypeScript adaptation
 * and integration with the existing Invokers library patterns.
 * 
 * @author Mason Freed (original polyfill), Patrick Glenn (TypeScript adaptation)
 * @license MIT / BSD (compatible with original polyfill license)
 */
