<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invokers.js - Interactive Cookbook</title>
  <style>
    /* --- Base Styles & Theme --- */
    :root {
      --brand-primary: #6a0dad; --brand-secondary: #4CAF50; --brand-accent: #f39c12;
      --border-color: #e0e0e0; --bg-color: #fff; --text-color: #333; --surface-color: #f9f9f9;
      --success-bg: #e8f5e9; --success-border: #a5d6a7;
    }
    html { scroll-padding-top: 2rem; scroll-behavior: smooth; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6; color: var(--text-color); background-color: var(--bg-color); margin: 0; padding: 2rem;
    }
    main { max-width: 800px; margin: 0 auto; }
    h1, h2, h3 { color: var(--brand-primary); line-height: 1.2; }
    h1 { font-size: 2.5rem; text-align: center; margin-bottom: 0.5rem; }
    h2 { border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; margin-top: 3.5rem; }
    h3 { margin-top: 2.5rem; color: #444; }
    p, li { color: #555; }
    code { background: #f0e6f8; color: var(--brand-primary); padding: 0.2em 0.4em; border-radius: 4px; font-family: monospace; }
    button {
      font-size: 1rem; padding: 0.6em 1.2em; border-radius: 8px; border: 1px solid var(--brand-primary);
      background-color: var(--brand-primary); color: white; cursor: pointer; transition: all 0.2s;
    }
    button:hover { background-color: #580a94; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    button:active { transform: translateY(0); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    button:disabled { background-color: #ccc; border-color: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .demo-box { border: 1px solid var(--border-color); padding: 1.5rem; border-radius: 8px; background: var(--surface-color); margin-top: 1rem; }
    .note { background-color: #fffbe5; border-left: 4px solid var(--brand-accent); padding: 1rem; border-radius: 4px; margin: 1.5rem 0; }

    /* Component-specific Styles */
    .dark-mode { --bg-color: #222; --text-color: #eee; --surface-color: #333; --border-color: #444; }
    .is-active { border-color: var(--brand-secondary); box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
    [role="tablist"] button { background: #eee; border-color: #ccc; color: #555; box-shadow: none; }
    [role="tablist"] button[aria-expanded="true"] { background: var(--brand-primary); border-color: var(--brand-primary); color: white; transform: none; }
    dialog { border: 2px solid var(--brand-primary); border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); padding: 2rem; }
    form > label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
    form > input { width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; }
    form > * + * { margin-top: 1rem; }
    #dynamic-content-area { border-style: dashed; border-color: var(--brand-accent); transition: all 0.3s; }
    .success-message { background-color: var(--success-bg); border: 1px solid var(--success-border); color: #1b5e20; text-align: center; }

    /* View Transition API Support */
    @keyframes fade-in { from { opacity: 0; } }
    @keyframes fade-out { to { opacity: 0; } }
    ::view-transition-old(root) { animation: 180ms cubic-bezier(0.4, 0, 1, 1) both fade-out; }
    ::view-transition-new(root) { animation: 300ms cubic-bezier(0, 0, 0.2, 1) both fade-in; }
  </style>
</head>
<body id="page-body">

  <main>
    <h1>Invokers.js Interactive Cookbook</h1>
    <p style="text-align: center;">A showcase of declarative UI patterns using the future of HTML. Open your console to see helpful warnings!</p>

    <!-- =================================================================== -->
    <h2 id="live-demo">Live Demo: Infinite Swaps & Forms</h2>
    <!-- =================================================================== -->
    <p>This is the best way to understand Invokers. Click the button below to start a multi-step flow that demonstrates content swapping, form submission, and chained invokers, all without a single page reload.</p>
    <div id="dynamic-content-area" class="demo-box">
      <!-- The content inside this div will be dynamically replaced -->
      <p>This is the initial state. The button below will replace this content with the first step.</p>
    </div>
    <p style="text-align: center; margin-top: 1rem;">
      <button type="button" command="--dom:swap" commandfor="dynamic-content-area" data-template-id="step-1-template">
        Begin Demo
      </button>
    </p>

    <!-- =================================================================== -->
    <h2 id="foundations">Part 1: Foundational Concepts</h2>
    <!-- =================================================================== -->
    <p>These examples cover the core building blocks of declarative UI.</p>

    <h3>Native Commands: Controlling a <code>&lt;dialog&gt;</code></h3>
    <div class="demo-box">
      <button type="button" command="show-modal" commandfor="my-dialog">Open Dialog</button>
      <dialog id="my-dialog">
        <h3>Modal Dialog</h3>
        <p>This dialog was opened declaratively. The library's polyfill ensures this works in all modern browsers.</p>
        <button type="button" command="close" commandfor="my-dialog">Close</button>
      </dialog>
    </div>

    <h3><code>--toggle</code>: Accordions & Disclosures</h3>
    <div class="demo-box">
      <button type="button" command="--toggle" commandfor="faq-1" aria-expanded="false">
        <strong>What does `commandfor` do?</strong>
      </button>
      <div id="faq-1" hidden>
        <p>It's the standard attribute from the W3C/WHATWG proposal that links an invoker button to its target element via the target's ID.</p>
      </div>
    </div>
    
    <h3><code>--show</code>: Accessible Tab Panels</h3>
    <div class="demo-box">
      <div role="tablist" aria-label="Feature Tabs">
        <button type="button" command="--show" commandfor="panel-1" aria-expanded="true">Tab 1</button>
        <button type="button" command="--show" commandfor="panel-2" aria-expanded="false">Tab 2</button>
      </div>
      <div style="padding-top: 1rem;">
        <div role="tabpanel" id="panel-1">Content for the first tab panel.</div>
        <div role="tabpanel" id="panel-2" hidden>Content for the second tab panel.</div>
      </div>
    </div>

    <!-- =================================================================== -->
    <h2 id="advanced">Part 2: Advanced Techniques</h2>
    <!-- =================================================================== -->
    
    <h3>Extending Invokers with Custom JavaScript</h3>
    <div class="demo-box">
      <p>This button uses a custom <code>--log</code> command registered in the script block below. Open your console to see the output!</p>
      <button type="button" command="--log:info:Hello from a custom command!" commandfor="page-body">Run Custom 'log' Command</button>
    </div>

    <h3>A Note on Backwards Compatibility</h3>
    <div class="note">
      <p><strong>Upgrading from v0.x?</strong> The old pattern <code>&lt;button command="toggle" aria-controls="menu"&gt;</code> should be updated to the new, standard pattern: <code>&lt;button type="button" command="--toggle" commandfor="menu"&gt;</code>. The library will try to handle old markup and warn you in the console, but updating is highly recommended!</p>
    </div>
  </main>

  <!-- =================================================================== -->
  <!-- TEMPLATES for the Live Demo & Other Examples -->
  <!-- =================================================================== -->

  <!-- Step 1 of the Live Demo -->
  <template id="step-1-template">
    <h3>Step 1: Content Loaded</h3>
    <p>This content was swapped in from a <code>&lt;template&gt;</code> tag. The button below is a *new* invoker that was just added to the page. It will work immediately.</p>
    <button type="button" command="--dom:swap" commandfor="dynamic-content-area" data-template-id="step-2-form-template">
      Load Contact Form &rarr;
    </button>
  </template>

  <!-- Step 2 of the Live Demo (The Form) -->
  <template id="step-2-form-template">
    <h3>Step 2: A Form Loaded via Fetch</h3>
    <p>This form will be "submitted" using <code>--fetch:send</code>. We'll simulate a successful server response.</p>
    <form id="contact-form" action="/api/contact" method="post">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" value="Jane Doe" required>
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" value="jane.doe@example.com" required>
      <button type="submit" command="--fetch:send" commandfor="contact-form">
        Submit Form
      </button>
    </form>
  </template>

  <!-- Step 3 of the Live Demo (Success Message) -->
  <template id="form-success-template">
    <div class="success-message">
      <h3>Step 3: Success!</h3>
      <p>The form was "submitted" and the server returned this success message. This demonstrates a complete, interactive loop.</p>
      <button type="button" command="--dom:swap" commandfor="dynamic-content-area" data-template-id="step-1-template">
        Start Over
      </button>
    </div>
  </template>

  <!-- General purpose templates -->
  <template id="spinner-template">
    <div style="display: flex; align-items: center; justify-content: center; color: #888; padding: 1rem;">
      <svg width="24" height="24" viewBox="0 0 24 24" style="margin-right: 0.5rem;" fill="currentColor"><path d="M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"><animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></path></svg>
      Loading...
    </div>
  </template>
  <template id="error-template">
    <p style="color: tomato; font-weight: bold;">Oops! Something went wrong.</p>
  </template>

  <!-- =================================================================== -->
  <!-- SCRIPT SETUP -->
  <!-- =================================================================== -->
  <script type="module">
    // 1. Import the core library. This automatically applies the polyfill
    //    and sets up the listener for custom `--` commands.
    import 'https://esm.sh/invokers';

    // 2. Import the `registerAll` function from the optional commands module.
    import { registerAll } from 'https://esm.sh/invokers/commands';

    // 3. Register all the extra commands to make them available.
    registerAll();
    console.log("✅ Invokers Core & Commands Module loaded and ready!");

    // 4. (Advanced) Register a project-specific command.
    if (window.Invoker) {
      /** @param {import('invokers').CommandContext} context */
      const customLogger = ({ invoker, params }) => {
        const [level, ...messageParts] = params;
        const message = messageParts.join(' ') || 'Invoker was triggered!';
        console[level === 'warn' || level === 'error' ? level : 'info'](
            `[Custom Logger]: ${message}`, { triggeredBy: invoker }
        );
      };
      window.Invoker.register('log', customLogger);
      console.log("✅ Custom '--log' command registered successfully!");
    }

    // 5. DEMO HELPER: Simulate a server response for the contact form.
    // In a real application, your server would handle this. This ensures the demo
    // works perfectly every time without needing a backend.
    document.addEventListener('submit', (event) => {
        const form = event.target;
        if (form.id === 'contact-form') {
            event.preventDefault(); // Stop the real form submission
            console.log("DEMO: Intercepted form submission. Simulating server response.");
            
            // Find the submit button and the target area
            const submitButton = form.querySelector('button[command="--fetch:send"]');
            const targetArea = document.getElementById('dynamic-content-area');
            const successTemplate = document.getElementById('form-success-template');

            if (submitButton && targetArea && successTemplate) {
                // Simulate a short delay
                targetArea.innerHTML = `<p>Submitting...</p>`;
                setTimeout(() => {
                    targetArea.innerHTML = successTemplate.innerHTML;
                }, 500);
            }
        }
    });
  </script>

</body>
</html>